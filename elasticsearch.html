<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>elasticsearch.html</title>
  <meta name="generator" content="Haroopad 0.12.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF) repeat scroll 0 0 transparent;background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:medium none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:medium none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:medium none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:none no-repeat scroll 5px -27px #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:none repeat scroll 0 0 #FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:none repeat scroll 0 0 #EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:none repeat scroll 0 0 #75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:#1A3C6C solid 1px;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-bottom-width:0;border-left-width:0;border-right-width:0;border-top-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;max-width:none;min-height:0;outline-color:#112644;outline-style:none;outline-width:0;overflow-x:visible;overflow-y:visible;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;border:0 none;color:#ccc;height:3px;padding:0}hr.underscore{border:0 none!important;height:30px;padding:0;-webkit-margin-before:0;-webkit-margin-after:0}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:#fff url(../img/ajax.gif) no-repeat center center}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}.markdown{padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-break:break-all;word-wrap:break-word}.markdown pre{border-radius:3px;word-break:break-all;word-wrap:break-word;overflow:auto}.markdown pre code{display:block}.markdown pre>code{border:1px solid #ccc;white-space:pre;padding:.5em;margin:0}.markdown code{border-radius:3px;word-break:break-all;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown table{padding:0;border-collapse:collapse;border-spacing:0}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.markdown em.underline{font-style:normal;text-decoration:underline}.markdown strong.highlight{color:#000;padding:0 5px;background-color:#fdffb6;-webkit-box-shadow:#fdffb6 0 0 5px;-moz-box-shadow:#fdffb6 0 0 5px;box-shadow:#fdffb6 0 0 5px}@import url(http://fonts.googleapis.com/css?family=Tauri);import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:300italic,400italic,700italic,400,300,700);.haroopad{padding:20px;color:#222;font-size:15px;font-family:'Roboto Condensed',Tauri,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",AppleSDGothicNeo-Medium,'Segoe UI','Malgun Gothic',Verdana,Tahoma,sans-serif;background:#fff;-webkit-font-smoothing:antialiased}.haroopad a{color:#3269a0}.haroopad a:hover{color:#4183c4}.haroopad h2{border-bottom:1px solid #e6e6e6;line-height:1.7em}.haroopad h6{color:#777}.haroopad hr{border:1px solid #e6e6e6}.haroopad blockquote>code,.haroopad h1>code,.haroopad h2>code,.haroopad h3>code,.haroopad h4>code,.haroopad h5>code,.haroopad h6>code,.haroopad li>code,.haroopad p>code,.haroopad td>code{color:#000;background-color:#feecdd;border:1px solid #efdfd0}.haroopad pre>code{font-size:1em;font-family:Consolas,Inconsolata,Courier,monospace;letter-spacing:-1px;font-weight:700}.haroopad blockquote{border-left:4px solid #e6e6e6;padding:0 15px;color:#777}.haroopad table{background-color:#fafafa}.haroopad table tr td,.haroopad table tr th{border:1px solid #e6e6e6}.haroopad table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;padding:.5em;background:#fdf6e3;color:#657b83}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.hljs-template_comment,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.haskell .hljs-type,.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.clojure .hljs-title,.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown haroopad">

  <h1 id="-elasticsearch-http-www-elasticsearch-com-"><a name="-elasticsearch-http-www-elasticsearch-com-" href="#-elasticsearch-http-www-elasticsearch-com-"></a><a href="http://www.elasticsearch.com/">ElasticSearch</a></h1><h4 id="elasticsearch-is-a-search-server-based-on-lucene-it-provides-a-distributed-multitenant-capable-full-text-search-engine-with-a-restful-web-interface-and-schema-free-json-documents-elasticsearch-is-developed-in-java-and-is-released-as-open-source-under-the-terms-of-the-apache-license-"><a name="elasticsearch-is-a-search-server-based-on-lucene-it-provides-a-distributed-multitenant-capable-full-text-search-engine-with-a-restful-web-interface-and-schema-free-json-documents-elasticsearch-is-developed-in-java-and-is-released-as-open-source-under-the-terms-of-the-apache-license-" href="#elasticsearch-is-a-search-server-based-on-lucene-it-provides-a-distributed-multitenant-capable-full-text-search-engine-with-a-restful-web-interface-and-schema-free-json-documents-elasticsearch-is-developed-in-java-and-is-released-as-open-source-under-the-terms-of-the-apache-license-"></a>Elasticsearch is a search server based on Lucene. It provides a distributed, multitenant-capable full-text search engine with a RESTful web interface and schema-free JSON documents. Elasticsearch is developed in Java and is released as open source under the terms of the Apache License.</h4><h2 id="overview"><a name="overview" href="#overview"></a>Overview</h2><ul>
<li>설치/실행이 간단하며, 클러스터링 구성이 용이</li>
<li><a href="http://www.elasticsearch.com/about/team/">Search Engine created by Shay Banon</a></li>
<li>Lucene based Search Engine<ul>
<li>Apache Lucene<sup>TM</sup> is a high-performance, full-featured text search engine library written entirely in Java. It is a technology suitable for nearly any application that requires full-text search, especially cross-platform.</li>
<li>created by Doug Cutting</li>
<li>Lucene은 사용가능한 완벽한 시스템이 아니라 색인, 검색등을 가능하게 하는 library 산출물임</li>
<li><a href="http://lucene.apache.org/solr/">Apache Solr(4.10.2)</a>, ElasticSearch(1.4.1)는 Lucene Library를 사용하여 제작한 시스템으로 사용자들이 직접 개발 하지 않고 검색(RESTful API)할 수 있는 방법을 제공함</li>
<li><a href="http://solr-vs-elasticsearch.com/">Apache Solr vs ElasticSearch</a><ul>
<li>Solr는 다양한 입력 포맷 지원(CSV, XML, JSON), 해외에서 높은 인지도, apache TLP</li>
<li>ES는 only-JSON, 운영편의성은 ES가 용이, 성능은 비슷함, elasticsearch 회사 지원</li>
</ul>
</li>
</ul>
</li>
<li><a href="http://www.elasticsearch.org/guide/">Various Programming API</a>(Java, Python, Javascript, PHP, Ruby, Perl Etc)</li>
<li>RESTful API<ul>
<li>GET/PUT/POST/DELETE/HEAD</li>
</ul>
</li>
<li>DBMS와는 달리 비정형화된 문서에서 데이터 검색</li>
<li>Multi-tenancy - 여러개의 Index에 한번의 질의 가능</li>
<li>Marvel plugin Install - 검색 <a href="http://172.16.100.102:9200/_plugin/marvel/sense/index.html">UI</a> 제공</li>
<li>Apache 2 license</li>
<li>HTTP(port 9200), Transport(port 9300)</li>
</ul><h2 id="elasticsearch-vs-dbms"><a name="elasticsearch-vs-dbms" href="#elasticsearch-vs-dbms"></a>ElasticSearch VS DBMS</h2><table>
<thead>
<tr>
<th>관계형 데이터베이스</th>
<th style="text-align:center">elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td style="text-align:center">Index</td>
</tr>
<tr>
<td>Table</td>
<td style="text-align:center">Type</td>
</tr>
<tr>
<td>Row</td>
<td style="text-align:center">Document</td>
</tr>
<tr>
<td>Column</td>
<td style="text-align:center">Field</td>
</tr>
<tr>
<td>Schema</td>
<td style="text-align:center">Mapping</td>
</tr>
<tr>
<td>Index</td>
<td style="text-align:center">Everything is indexed</td>
</tr>
<tr>
<td>SQL</td>
<td style="text-align:center">Query DSL</td>
</tr>
</tbody>
</table><p><a href="http://helloworld.naver.com/helloworld/textyle/273788">출처 - NAVER개발자블로그</a></p><h3 id="elasticsearch-http-172-16-100-102-9200-http-172-16-100-102-9200-"><a name="elasticsearch-http-172-16-100-102-9200-http-172-16-100-102-9200-" href="#elasticsearch-http-172-16-100-102-9200-http-172-16-100-102-9200-"></a>ElasticSearch 기본 화면 - <a href="http://172.16.100.102:9200"></a><a href="http://172.16.100.102:9200">http://172.16.100.102:9200</a></h3><p><code>curl -XGET 'http://172.16.100.102:9200'</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
  &quot;status&quot; : 200,
  &quot;name&quot; : &quot;Black Talon&quot;,
  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,
  &quot;version&quot; : {
    &quot;number&quot; : &quot;1.4.1&quot;,
    &quot;build_hash&quot; : &quot;89d3241d670db65f994242c8e8383b169779e2d4&quot;,
    &quot;build_timestamp&quot; : &quot;2014-11-26T15:49:29Z&quot;,
    &quot;build_snapshot&quot; : false,
    &quot;lucene_version&quot; : &quot;4.10.2&quot;
  },
  &quot;tagline&quot; : &quot;You Know, for Search&quot;
}
&lt;/code&gt;&lt;/pre&gt;">{
  "status" : 200,
  "name" : "Black Talon",
  "cluster_name" : "elasticsearch",
  "version" : {
    "number" : "1.4.1",
    "build_hash" : "89d3241d670db65f994242c8e8383b169779e2d4",
    "build_timestamp" : "2014-11-26T15:49:29Z",
    "build_snapshot" : false,
    "lucene_version" : "4.10.2"
  },
  "tagline" : "You Know, for Search"
}
</code></pre><h2 id="-"><a name="-" href="#-"></a>여기서 다루지 않는 것들</h2><ul>
<li>analysis</li>
<li>score(boostring query)</li>
<li>filter</li>
<li>설치와 운영 및 성능 관련</li>
<li>join via has_children and top_children queries</li>
<li>regexp query, bool query 등등</li>
<li>메모리 관련 이슈</li>
</ul><h2 id="indices-apis-"><a name="indices-apis-" href="#indices-apis-"></a>Indices APIs(문서의 생성과 삭제)</h2><ul>
<li><p>REST API형식</p>
<ul>
<li><a href="http://host:port/(index)/(type)/(action|id">http://host:port/(index)/(type)/(action|id</a>)</li>
</ul>
</li>
<li><p>인덱스 생성</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  PUT /test
&lt;/code&gt;&lt;/pre&gt;">  PUT /test
</code></pre></li>
<li><p>인덱스 확인</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  GET /test
&lt;/code&gt;&lt;/pre&gt;">  GET /test
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;  {
     &quot;test&quot;: {
        &quot;mappings&quot;: {},
        &quot;settings&quot;: {
           &quot;index&quot;: {
              &quot;creation_date&quot;: &quot;1418029762910&quot;,
              &quot;uuid&quot;: &quot;0A7XrxtpS_-_h825-C6jlA&quot;,
              &quot;number_of_replicas&quot;: &quot;1&quot;,
              &quot;number_of_shards&quot;: &quot;5&quot;,
              &quot;version&quot;: {
                 &quot;created&quot;: &quot;1040199&quot;
              }
           }
        }
     }
  }
&lt;/code&gt;&lt;/pre&gt;">  {
     "test": {
        "mappings": {},
        "settings": {
           "index": {
              "creation_date": "1418029762910",
              "uuid": "0A7XrxtpS_-_h825-C6jlA",
              "number_of_replicas": "1",
              "number_of_shards": "5",
              "version": {
                 "created": "1040199"
              }
           }
        }
     }
  }
</code></pre></li>
<li><p>인덱스 생성2</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  PUT /test/
  {
      &quot;settings&quot; : {
          &quot;index&quot; : {
              &quot;number_of_shards&quot; : 3,
              &quot;number_of_replicas&quot; : 2
          }
      }
  }
&lt;/code&gt;&lt;/pre&gt;">  PUT /test/
  {
      "settings" : {
          "index" : {
              "number_of_shards" : 3,
              "number_of_replicas" : 2
          }
      }
  }
</code></pre></li>
<li><p>인덱스 확인2</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  GET /test
&lt;/code&gt;&lt;/pre&gt;">  GET /test
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;  {
     &quot;test&quot;: {
        &quot;mappings&quot;: {},
        &quot;settings&quot;: {
           &quot;index&quot;: {
              &quot;creation_date&quot;: &quot;1418029976244&quot;,
              &quot;uuid&quot;: &quot;JR1JH0xaTM69IuPLCDULIw&quot;,
              &quot;number_of_replicas&quot;: &quot;2&quot;,
              &quot;number_of_shards&quot;: &quot;3&quot;,
              &quot;version&quot;: {
                 &quot;created&quot;: &quot;1040199&quot;
              }
           }
        }
     }
  }
&lt;/code&gt;&lt;/pre&gt;">  {
     "test": {
        "mappings": {},
        "settings": {
           "index": {
              "creation_date": "1418029976244",
              "uuid": "JR1JH0xaTM69IuPLCDULIw",
              "number_of_replicas": "2",
              "number_of_shards": "3",
              "version": {
                 "created": "1040199"
              }
           }
        }
     }
  }
</code></pre></li>
</ul><ul>
<li><p>인덱스 삭제</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  DELETE /test
&lt;/code&gt;&lt;/pre&gt;">  DELETE /test
</code></pre></li>
<li><p>인덱스 open/close</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  POST /test/_open
  POST /test/_close
&lt;/code&gt;&lt;/pre&gt;">  POST /test/_open
  POST /test/_close
</code></pre></li>
</ul><ul>
<li><p>데이타 입력</p>
<ul>
<li><p>schema free</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;PUT /test/type1/1
{
&quot;@timestamp&quot; : &quot;2014-12-08T00:13:09+00:00&quot;,
&quot;eps_time&quot; : &quot;1417965189.529396&quot;,
&quot;report_time&quot; : &quot;20141208001309&quot;,
&quot;src_ip&quot; : &quot;192.168.1.55&quot;
}
&lt;/code&gt;&lt;/pre&gt;">PUT /test/type1/1
{
"@timestamp" : "2014-12-08T00:13:09+00:00",
"eps_time" : "1417965189.529396",
"report_time" : "20141208001309",
"src_ip" : "192.168.1.55"
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /test/type1/_search
&lt;/code&gt;&lt;/pre&gt;">GET /test/type1/_search
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
 &quot;took&quot;: 1,
 &quot;timed_out&quot;: false,
 &quot;_shards&quot;: {
    &quot;total&quot;: 5,
    &quot;successful&quot;: 5,
    &quot;failed&quot;: 0
 },
 &quot;hits&quot;: {
    &quot;total&quot;: 1,
    &quot;max_score&quot;: 1,
    &quot;hits&quot;: [
       {
          &quot;_index&quot;: &quot;test&quot;,
          &quot;_type&quot;: &quot;type1&quot;,
          &quot;_id&quot;: &quot;1&quot;,
          &quot;_score&quot;: 1,
          &quot;_source&quot;: {
             &quot;@timestamp&quot;: &quot;2014-12-08T00:13:09+00:00&quot;,
             &quot;eps_time&quot;: &quot;1417965189.529396&quot;,
             &quot;report_time&quot;: &quot;20141208001309&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.55&quot;
          }
       }
    ]
 }
}
&lt;/code&gt;&lt;/pre&gt;">{
 "took": 1,
 "timed_out": false,
 "_shards": {
    "total": 5,
    "successful": 5,
    "failed": 0
 },
 "hits": {
    "total": 1,
    "max_score": 1,
    "hits": [
       {
          "_index": "test",
          "_type": "type1",
          "_id": "1",
          "_score": 1,
          "_source": {
             "@timestamp": "2014-12-08T00:13:09+00:00",
             "eps_time": "1417965189.529396",
             "report_time": "20141208001309",
             "src_ip": "192.168.1.55"
          }
       }
    ]
 }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;PUT /test/type1/2
{
&quot;@timestamp&quot; : &quot;2014-12-08T00:13:09+00:00&quot;,
&quot;eps_time&quot; : &quot;1417965189.529396&quot;,
&quot;report_time&quot; : &quot;20141208001309&quot;,
&quot;src_ip&quot; : &quot;192.168.1.55&quot;
}
&lt;/code&gt;&lt;/pre&gt;">PUT /test/type1/2
{
"@timestamp" : "2014-12-08T00:13:09+00:00",
"eps_time" : "1417965189.529396",
"report_time" : "20141208001309",
"src_ip" : "192.168.1.55"
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
 &quot;took&quot;: 2,
 &quot;timed_out&quot;: false,
 &quot;_shards&quot;: {
    &quot;total&quot;: 5,
    &quot;successful&quot;: 5,
    &quot;failed&quot;: 0
 },
 &quot;hits&quot;: {
    &quot;total&quot;: 2,
    &quot;max_score&quot;: 1,
    &quot;hits&quot;: [
       {
          &quot;_index&quot;: &quot;test&quot;,
          &quot;_type&quot;: &quot;type1&quot;,
          &quot;_id&quot;: &quot;1&quot;,
          &quot;_score&quot;: 1,
          &quot;_source&quot;: {
             &quot;@timestamp&quot;: &quot;2014-12-08T00:13:09+00:00&quot;,
             &quot;eps_time&quot;: &quot;1417965189.529396&quot;,
             &quot;report_time&quot;: &quot;20141208001309&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.55&quot;
          }
       },
       {
          &quot;_index&quot;: &quot;test&quot;,
          &quot;_type&quot;: &quot;type1&quot;,
          &quot;_id&quot;: &quot;2&quot;,
          &quot;_score&quot;: 1,
          &quot;_source&quot;: {
             &quot;@timestamp&quot;: &quot;2014-12-08T00:13:09+00:00&quot;,
             &quot;eps_time&quot;: &quot;1417965189.529396&quot;,
             &quot;report_time&quot;: &quot;20141208001309&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.55&quot;
          }
       }
    ]
 }
}
&lt;/code&gt;&lt;/pre&gt;">{
 "took": 2,
 "timed_out": false,
 "_shards": {
    "total": 5,
    "successful": 5,
    "failed": 0
 },
 "hits": {
    "total": 2,
    "max_score": 1,
    "hits": [
       {
          "_index": "test",
          "_type": "type1",
          "_id": "1",
          "_score": 1,
          "_source": {
             "@timestamp": "2014-12-08T00:13:09+00:00",
             "eps_time": "1417965189.529396",
             "report_time": "20141208001309",
             "src_ip": "192.168.1.55"
          }
       },
       {
          "_index": "test",
          "_type": "type1",
          "_id": "2",
          "_score": 1,
          "_source": {
             "@timestamp": "2014-12-08T00:13:09+00:00",
             "eps_time": "1417965189.529396",
             "report_time": "20141208001309",
             "src_ip": "192.168.1.55"
          }
       }
    ]
 }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;POST /test/type1/
{
&quot;@timestamp&quot; : &quot;2014-12-08T00:13:09+00:00&quot;,
&quot;eps_time&quot; : &quot;1417965189.529396&quot;,
&quot;report_time&quot; : &quot;20141208001309&quot;,
&quot;src_ip&quot; : &quot;192.168.1.55&quot;
}
&lt;/code&gt;&lt;/pre&gt;">POST /test/type1/
{
"@timestamp" : "2014-12-08T00:13:09+00:00",
"eps_time" : "1417965189.529396",
"report_time" : "20141208001309",
"src_ip" : "192.168.1.55"
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
 &quot;took&quot;: 1,
 &quot;timed_out&quot;: false,
 &quot;_shards&quot;: {
    &quot;total&quot;: 5,
    &quot;successful&quot;: 5,
    &quot;failed&quot;: 0
 },
 &quot;hits&quot;: {
    &quot;total&quot;: 3,
    &quot;max_score&quot;: 1,
    &quot;hits&quot;: [
       {
          &quot;_index&quot;: &quot;test&quot;,
          &quot;_type&quot;: &quot;type1&quot;,
          &quot;_id&quot;: &quot;1&quot;,
          &quot;_score&quot;: 1,
          &quot;_source&quot;: {
             &quot;@timestamp&quot;: &quot;2014-12-08T00:13:09+00:00&quot;,
             &quot;eps_time&quot;: &quot;1417965189.529396&quot;,
             &quot;report_time&quot;: &quot;20141208001309&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.55&quot;
          }
       },
       {
          &quot;_index&quot;: &quot;test&quot;,
          &quot;_type&quot;: &quot;type1&quot;,
          &quot;_id&quot;: &quot;2&quot;,
          &quot;_score&quot;: 1,
          &quot;_source&quot;: {
             &quot;@timestamp&quot;: &quot;2014-12-08T00:13:09+00:00&quot;,
             &quot;eps_time&quot;: &quot;1417965189.529396&quot;,
             &quot;report_time&quot;: &quot;20141208001309&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.55&quot;
          }
       },
       {
          &quot;_index&quot;: &quot;test&quot;,
          &quot;_type&quot;: &quot;type1&quot;,
          &quot;_id&quot;: &quot;AUopZk9jpjgjdLKhDz-s&quot;,
          &quot;_score&quot;: 1,
          &quot;_source&quot;: {
             &quot;@timestamp&quot;: &quot;2014-12-08T00:13:09+00:00&quot;,
             &quot;eps_time&quot;: &quot;1417965189.529396&quot;,
             &quot;report_time&quot;: &quot;20141208001309&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.55&quot;
          }
       }
    ]
 }
}
&lt;/code&gt;&lt;/pre&gt;">{
 "took": 1,
 "timed_out": false,
 "_shards": {
    "total": 5,
    "successful": 5,
    "failed": 0
 },
 "hits": {
    "total": 3,
    "max_score": 1,
    "hits": [
       {
          "_index": "test",
          "_type": "type1",
          "_id": "1",
          "_score": 1,
          "_source": {
             "@timestamp": "2014-12-08T00:13:09+00:00",
             "eps_time": "1417965189.529396",
             "report_time": "20141208001309",
             "src_ip": "192.168.1.55"
          }
       },
       {
          "_index": "test",
          "_type": "type1",
          "_id": "2",
          "_score": 1,
          "_source": {
             "@timestamp": "2014-12-08T00:13:09+00:00",
             "eps_time": "1417965189.529396",
             "report_time": "20141208001309",
             "src_ip": "192.168.1.55"
          }
       },
       {
          "_index": "test",
          "_type": "type1",
          "_id": "AUopZk9jpjgjdLKhDz-s",
          "_score": 1,
          "_source": {
             "@timestamp": "2014-12-08T00:13:09+00:00",
             "eps_time": "1417965189.529396",
             "report_time": "20141208001309",
             "src_ip": "192.168.1.55"
          }
       }
    ]
 }
}
</code></pre></li>
<li><p>Mapping</p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141209/conn/_mapping
GET connectome-20141209/_mapping/conn
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141209/conn/_mapping
GET connectome-20141209/_mapping/conn
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
&quot;connectome-20141209&quot;: {
  &quot;mappings&quot;: {
       &quot;conn&quot;: {
              &quot;properties&quot;: {
                 &quot;@timestamp&quot;: {
                    &quot;type&quot;: &quot;date&quot;,
                    &quot;format&quot;: &quot;dateOptionalTime&quot;
                 },
                 &quot;app_prtc&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;conn_local&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;conn_state&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;device_ip&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;dst_asn&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;dst_asname&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;dst_bytes&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;dst_cc&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;dst_ip&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;dst_ip_bytes&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;dst_lati&quot;: {
                    &quot;type&quot;: &quot;double&quot;
                 },
                 &quot;dst_long&quot;: {
                    &quot;type&quot;: &quot;double&quot;
                 },
                 &quot;dst_pkts&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;dst_port&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;duration&quot;: {
                    &quot;type&quot;: &quot;double&quot;
                 },
                 &quot;elastic_time&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;eps_time&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;history&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;log_type_Name&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;missed_bytes&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;pcr&quot;: {
                    &quot;type&quot;: &quot;double&quot;
                 },
                 &quot;prtc&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;report_time&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;resp_cname&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;src_asn&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;src_asname&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;src_bytes&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;src_cc&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;src_country_name&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;src_ip&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;src_ip_bytes&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;src_lati&quot;: {
                    &quot;type&quot;: &quot;double&quot;
                 },
                 &quot;src_long&quot;: {
                    &quot;type&quot;: &quot;double&quot;
                 },
                 &quot;src_pkts&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                 },
                 &quot;src_port&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;tunnel_parents&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 },
                 &quot;uid&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                 }
              }
           }
        }
     }
  }
&lt;/code&gt;&lt;/pre&gt;">{
"connectome-20141209": {
  "mappings": {
       "conn": {
              "properties": {
                 "@timestamp": {
                    "type": "date",
                    "format": "dateOptionalTime"
                 },
                 "app_prtc": {
                    "type": "string"
                 },
                 "conn_local": {
                    "type": "string"
                 },
                 "conn_state": {
                    "type": "string"
                 },
                 "device_ip": {
                    "type": "string"
                 },
                 "dst_asn": {
                    "type": "long"
                 },
                 "dst_asname": {
                    "type": "string"
                 },
                 "dst_bytes": {
                    "type": "long"
                 },
                 "dst_cc": {
                    "type": "string"
                 },
                 "dst_ip": {
                    "type": "string"
                 },
                 "dst_ip_bytes": {
                    "type": "long"
                 },
                 "dst_lati": {
                    "type": "double"
                 },
                 "dst_long": {
                    "type": "double"
                 },
                 "dst_pkts": {
                    "type": "long"
                 },
                 "dst_port": {
                    "type": "string"
                 },
                 "duration": {
                    "type": "double"
                 },
                 "elastic_time": {
                    "type": "string"
                 },
                 "eps_time": {
                    "type": "string"
                 },
                 "history": {
                    "type": "string"
                 },
                 "log_type_Name": {
                    "type": "string"
                 },
                 "missed_bytes": {
                    "type": "long"
                 },
                 "pcr": {
                    "type": "double"
                 },
                 "prtc": {
                    "type": "string"
                 },
                 "report_time": {
                    "type": "string"
                 },
                 "resp_cname": {
                    "type": "string"
                 },
                 "src_asn": {
                    "type": "long"
                 },
                 "src_asname": {
                    "type": "string"
                 },
                 "src_bytes": {
                    "type": "long"
                 },
                 "src_cc": {
                    "type": "string"
                 },
                 "src_country_name": {
                    "type": "string"
                 },
                 "src_ip": {
                    "type": "string"
                 },
                 "src_ip_bytes": {
                    "type": "long"
                 },
                 "src_lati": {
                    "type": "double"
                 },
                 "src_long": {
                    "type": "double"
                 },
                 "src_pkts": {
                    "type": "long"
                 },
                 "src_port": {
                    "type": "string"
                 },
                 "tunnel_parents": {
                    "type": "string"
                 },
                 "uid": {
                    "type": "string"
                 }
              }
           }
        }
     }
  }
</code></pre></li>
</ul>
</li>
</ul><ul>
<li>데이터 삭제<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  DELETE /test/type1/1
&lt;/code&gt;&lt;/pre&gt;">  DELETE /test/type1/1
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;  DELETE /test/type1
&lt;/code&gt;&lt;/pre&gt;">  DELETE /test/type1
</code></pre></li>
<li><p>데이터 수정</p>
</li>
<li><p>데이터 입력(bulk)</p>
<p>  <code>curl -s -XPOST localhost:9200/_bulk --data-binary @requests; echo</code></p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  action_and_meta_data\n
  optional_source\n
  action_and_meta_data\n
  optional_source\n
  ....
  action_and_meta_data\n
  optional_source\n
&lt;/code&gt;&lt;/pre&gt;">  action_and_meta_data\n
  optional_source\n
  action_and_meta_data\n
  optional_source\n
  ....
  action_and_meta_data\n
  optional_source\n
</code></pre><p>  <code>requests</code></p>
<pre><code data-origin="&lt;pre&gt;&lt;code&gt;  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:11:42+00:00&quot;,&quot;eps_time&quot; : &quot;1417965102.639954&quot;,&quot;report_time&quot; : &quot;20141208001142&quot;,&quot;src_ip&quot; : &quot;192.168.1.55&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:41+00:00&quot;,&quot;eps_time&quot; : &quot;1417965161.314342&quot;,&quot;report_time&quot; : &quot;20141208001241&quot;,&quot;src_ip&quot; : &quot;192.168.1.100&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:41+00:00&quot;,&quot;eps_time&quot; : &quot;1417965161.327586&quot;,&quot;report_time&quot; : &quot;20141208001241&quot;,&quot;src_ip&quot; : &quot;192.168.1.100&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:41+00:00&quot;,&quot;eps_time&quot; : &quot;1417965161.314338&quot;,&quot;report_time&quot; : &quot;20141208001241&quot;,&quot;src_ip&quot; : &quot;192.168.1.100&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:53+00:00&quot;,&quot;eps_time&quot; : &quot;1417965173.701496&quot;,&quot;report_time&quot; : &quot;20141208001253&quot;,&quot;src_ip&quot; : &quot;192.168.1.55&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:56+00:00&quot;,&quot;eps_time&quot; : &quot;1417965176.154323&quot;,&quot;report_time&quot; : &quot;20141208001256&quot;,&quot;src_ip&quot; : &quot;192.168.1.55&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:57+00:00&quot;,&quot;eps_time&quot; : &quot;1417965177.263694&quot;,&quot;report_time&quot; : &quot;20141208001257&quot;,&quot;src_ip&quot; : &quot;192.168.1.55&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:59+00:00&quot;,&quot;eps_time&quot; : &quot;1417965179.339803&quot;,&quot;report_time&quot; : &quot;20141208001259&quot;,&quot;src_ip&quot; : &quot;192.168.1.31&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:12:59+00:00&quot;,&quot;eps_time&quot; : &quot;1417965179.341043&quot;,&quot;report_time&quot; : &quot;20141208001259&quot;,&quot;src_ip&quot; : &quot;192.168.1.31&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:13:09+00:00&quot;,&quot;eps_time&quot; : &quot;1417965189.529396&quot;,&quot;report_time&quot; : &quot;20141208001309&quot;,&quot;src_ip&quot; : &quot;192.168.1.55&quot;}
  { &quot;index&quot; : { &quot;_index&quot; : &quot;test1&quot;, &quot;_type&quot; : &quot;type1&quot;} }
  {&quot;@timestamp&quot; : &quot;2014-12-08T00:13:06+00:00&quot;,&quot;eps_time&quot; : &quot;1417965186.826456&quot;,&quot;report_time&quot; : &quot;20141208001306&quot;,&quot;src_ip&quot; : &quot;192.168.1.55&quot;}
&lt;/code&gt;&lt;/pre&gt;">  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:11:42+00:00","eps_time" : "1417965102.639954","report_time" : "20141208001142","src_ip" : "192.168.1.55"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:41+00:00","eps_time" : "1417965161.314342","report_time" : "20141208001241","src_ip" : "192.168.1.100"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:41+00:00","eps_time" : "1417965161.327586","report_time" : "20141208001241","src_ip" : "192.168.1.100"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:41+00:00","eps_time" : "1417965161.314338","report_time" : "20141208001241","src_ip" : "192.168.1.100"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:53+00:00","eps_time" : "1417965173.701496","report_time" : "20141208001253","src_ip" : "192.168.1.55"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:56+00:00","eps_time" : "1417965176.154323","report_time" : "20141208001256","src_ip" : "192.168.1.55"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:57+00:00","eps_time" : "1417965177.263694","report_time" : "20141208001257","src_ip" : "192.168.1.55"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:59+00:00","eps_time" : "1417965179.339803","report_time" : "20141208001259","src_ip" : "192.168.1.31"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:12:59+00:00","eps_time" : "1417965179.341043","report_time" : "20141208001259","src_ip" : "192.168.1.31"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:13:09+00:00","eps_time" : "1417965189.529396","report_time" : "20141208001309","src_ip" : "192.168.1.55"}
  { "index" : { "_index" : "test1", "_type" : "type1"} }
  {"@timestamp" : "2014-12-08T00:13:06+00:00","eps_time" : "1417965186.826456","report_time" : "20141208001306","src_ip" : "192.168.1.55"}
</code></pre></li>
</ul><h2 id="search-apis"><a name="search-apis" href="#search-apis"></a>Search APIs</h2><h3 id="search"><a name="search" href="#search"></a>Search</h3><ul>
<li>인덱스는 반드시 작성하거나 모두 생략</li>
<li><em>METHOD /indices/types/command</em></li>
<li><em>METHOD /indices/types/id</em></li>
<li><em>METHOD /indices/command</em></li>
<li><em>METHOD /command</em></li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /indices/type/id
GET /_all/_search?size=1000
GET /_search?size=1000
&lt;/code&gt;&lt;/pre&gt;">GET /indices/type/id
GET /_all/_search?size=1000
GET /_search?size=1000
</code></pre><ul>
<li>Conectome에서는 ‘connectome-YYYYMMDD’ 날짜별 Index생성, 파일로그명으로 type구성 각 로그의 uid를 elasticsearch document의 id로 사용함, id를 사용하려면 indices, type 모두 지정되어 있어야함</li>
<li>size를 명시하지 않으면 기본적으로 10이 적용됨</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141206/conn/CTjrCi3Omh3YC9g1ve
GET /connectome-20141206/http/_search?q=*:*
GET /connectome-20141206/http/_search
GET /connectome-20141206/http,conn,dns/_search
GET /connectome-20141206,connectome-20141207/conn,http,dns/_search
GET /_all/_search?size=1000
GET /_search?size=1000
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141206/conn/CTjrCi3Omh3YC9g1ve
GET /connectome-20141206/http/_search?q=*:*
GET /connectome-20141206/http/_search
GET /connectome-20141206/http,conn,dns/_search
GET /connectome-20141206,connectome-20141207/conn,http,dns/_search
GET /_all/_search?size=1000
GET /_search?size=1000
</code></pre><h3 id="uri-search"><a name="uri-search" href="#uri-search"></a>URI Search</h3><ul>
<li>기존의 lucene query를 그대로 사용할 수 있는 장점이 있음</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141202/conn/_search?q=src_ip:192.168.1.151&amp;amp;from=0&amp;amp;size=20&amp;amp;sort=report_time:desc,src_ip:asc
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141202/conn/_search?q=src_ip:192.168.1.151&amp;from=0&amp;size=20&amp;sort=report_time:desc,src_ip:asc
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 234,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 1,
      &quot;successful&quot;: 1,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 10951,
      &quot;max_score&quot;: null,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141202&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CR2dMm4xIGtLaioea3&quot;,
            &quot;_score&quot;: null,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141202165719&quot;,
               &quot;src_bytes&quot;: &quot;38&quot;,
               &quot;uid&quot;: &quot;CR2dMm4xIGtLaioea3&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-02T16:57:19+00:00&quot;,
               &quot;resp_cname&quot;: &quot;unknown-&quot;,
               &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
               &quot;dst_ip_bytes&quot;: &quot;150&quot;,
               &quot;dst_asn&quot;: &quot;0&quot;,
               &quot;dst_asname&quot;: &quot;unknown-0&quot;,
               &quot;duration&quot;: &quot;0.003108&quot;,
               &quot;src_lati&quot;: &quot;0.0&quot;,
               &quot;src_port&quot;: &quot;62457&quot;,
               &quot;src_country_name&quot;: &quot;unknown-&quot;,
               &quot;conn_state&quot;: &quot;SF&quot;,
               &quot;pcr&quot;: &quot;-0.525&quot;,
               &quot;elastic_time&quot;: &quot;20141202165737&quot;,
               &quot;src_asn&quot;: &quot;0&quot;,
               &quot;src_ip&quot;: &quot;192.168.1.151&quot;,
               &quot;src_cc&quot;: &quot;(empty)&quot;,
               &quot;src_pkts&quot;: &quot;1&quot;,
               &quot;dst_long&quot;: &quot;0.0&quot;,
               &quot;dst_cc&quot;: &quot;(empty)&quot;,
               &quot;device_ip&quot;: &quot;172.16.2.3&quot;,
               &quot;prtc&quot;: &quot;udp&quot;,
               &quot;dst_lati&quot;: &quot;0.0&quot;,
               &quot;missed_bytes&quot;: &quot;0&quot;,
               &quot;app_prtc&quot;: &quot;dns&quot;,
               &quot;conn_local&quot;: &quot;T&quot;,
               &quot;dst_pkts&quot;: &quot;1&quot;,
               &quot;log_type_Name&quot;: &quot;conn.log&quot;,
               &quot;src_long&quot;: &quot;0.0&quot;,
               &quot;eps_time&quot;: &quot;1417507039.717880&quot;,
               &quot;dst_port&quot;: &quot;53&quot;,
               &quot;dst_ip&quot;: &quot;172.16.3.6&quot;,
               &quot;src_ip_bytes&quot;: &quot;66&quot;,
               &quot;dst_bytes&quot;: &quot;122&quot;,
               &quot;history&quot;: &quot;Dd&quot;
            },
            &quot;sort&quot;: [
               &quot;20141202165719&quot;,
               &quot;192.168.1.151&quot;
            ]
         },
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 234,
   "timed_out": false,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "hits": {
      "total": 10951,
      "max_score": null,
      "hits": [
         {
            "_index": "connectome-20141202",
            "_type": "conn",
            "_id": "CR2dMm4xIGtLaioea3",
            "_score": null,
            "_source": {
               "report_time": "20141202165719",
               "src_bytes": "38",
               "uid": "CR2dMm4xIGtLaioea3",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-02T16:57:19+00:00",
               "resp_cname": "unknown-",
               "tunnel_parents": "(empty)",
               "dst_ip_bytes": "150",
               "dst_asn": "0",
               "dst_asname": "unknown-0",
               "duration": "0.003108",
               "src_lati": "0.0",
               "src_port": "62457",
               "src_country_name": "unknown-",
               "conn_state": "SF",
               "pcr": "-0.525",
               "elastic_time": "20141202165737",
               "src_asn": "0",
               "src_ip": "192.168.1.151",
               "src_cc": "(empty)",
               "src_pkts": "1",
               "dst_long": "0.0",
               "dst_cc": "(empty)",
               "device_ip": "172.16.2.3",
               "prtc": "udp",
               "dst_lati": "0.0",
               "missed_bytes": "0",
               "app_prtc": "dns",
               "conn_local": "T",
               "dst_pkts": "1",
               "log_type_Name": "conn.log",
               "src_long": "0.0",
               "eps_time": "1417507039.717880",
               "dst_port": "53",
               "dst_ip": "172.16.3.6",
               "src_ip_bytes": "66",
               "dst_bytes": "122",
               "history": "Dd"
            },
            "sort": [
               "20141202165719",
               "192.168.1.151"
            ]
         },
</code></pre><ul>
<li>필드(fields)를 지정할 수 있음</li>
<li>필드를 지정할 경우 결과가 배열로 출력된다는 점에 유의</li>
<li>필드가 존재하지 않는 document일 경우 출력되지 않음</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141202/conn/_search?q=src_ip:192.168.1.151&amp;amp;from=0&amp;amp;size=20&amp;amp;sort=report_time:desc,src_ip:asc&amp;amp;fields=report_time,src_ip,dst_ip,pcr
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141202/conn/_search?q=src_ip:192.168.1.151&amp;from=0&amp;size=20&amp;sort=report_time:desc,src_ip:asc&amp;fields=report_time,src_ip,dst_ip,pcr
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 5,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 1,
      &quot;successful&quot;: 1,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 10974,
      &quot;max_score&quot;: null,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141202&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CaBzO21djoItCJNKOh&quot;,
            &quot;_score&quot;: null,
            &quot;fields&quot;: {
               &quot;report_time&quot;: [
                  &quot;20141202170039&quot;
               ],
               &quot;pcr&quot;: [
                  &quot;-0.819512&quot;
               ],
               &quot;src_ip&quot;: [
                  &quot;192.168.1.151&quot;
               ],
               &quot;dst_ip&quot;: [
                  &quot;172.16.3.6&quot;
               ]
            },
            &quot;sort&quot;: [
               &quot;20141202170039&quot;,
               &quot;192.168.1.151&quot;
            ]
         },
         {
            &quot;_index&quot;: &quot;connectome-20141202&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CEGtLa2Vx4PnRChNS2&quot;,
            &quot;_score&quot;: null,
            &quot;fields&quot;: {
               &quot;report_time&quot;: [
                  &quot;20141202170007&quot;
               ],
               &quot;pcr&quot;: [
                  &quot;-0.679245&quot;
               ],
               &quot;src_ip&quot;: [
                  &quot;192.168.1.151&quot;
               ],
               &quot;dst_ip&quot;: [
                  &quot;172.16.3.6&quot;
               ]
            },
            &quot;sort&quot;: [
               &quot;20141202170007&quot;,
               &quot;192.168.1.151&quot;
            ]
         },
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 5,
   "timed_out": false,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "hits": {
      "total": 10974,
      "max_score": null,
      "hits": [
         {
            "_index": "connectome-20141202",
            "_type": "conn",
            "_id": "CaBzO21djoItCJNKOh",
            "_score": null,
            "fields": {
               "report_time": [
                  "20141202170039"
               ],
               "pcr": [
                  "-0.819512"
               ],
               "src_ip": [
                  "192.168.1.151"
               ],
               "dst_ip": [
                  "172.16.3.6"
               ]
            },
            "sort": [
               "20141202170039",
               "192.168.1.151"
            ]
         },
         {
            "_index": "connectome-20141202",
            "_type": "conn",
            "_id": "CEGtLa2Vx4PnRChNS2",
            "_score": null,
            "fields": {
               "report_time": [
                  "20141202170007"
               ],
               "pcr": [
                  "-0.679245"
               ],
               "src_ip": [
                  "192.168.1.151"
               ],
               "dst_ip": [
                  "172.16.3.6"
               ]
            },
            "sort": [
               "20141202170007",
               "192.168.1.151"
            ]
         },
</code></pre><h3 id="request-body-search-query-dsl-"><a name="request-body-search-query-dsl-" href="#request-body-search-query-dsl-"></a>Request Body Search(QUERY DSL)</h3><ul>
<li>기본 검색</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET _search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET _search
{
  "query": {
    "match_all": {}
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 4,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 28,
      &quot;successful&quot;: 28,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 692211,
      &quot;max_score&quot;: 1,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;.marvel-2014.12.03&quot;,
            &quot;_type&quot;: &quot;node_stats&quot;,
            &quot;_id&quot;: &quot;AUoQL90PWVwb65544Xyb&quot;,
            &quot;_score&quot;: 1,
            &quot;_source&quot;: {
               &quot;@timestamp&quot;: &quot;2014-12-03T12:46:19.677Z&quot;,
               &quot;cluster_name&quot;: &quot;elasticsearch&quot;,
               &quot;node&quot;: {
                  &quot;id&quot;: &quot;b-I02eBqQqCgp7hZaezZpw&quot;,
                  &quot;name&quot;: &quot;Geirrodur&quot;,
                  &quot;transport_address&quot;: &quot;inet[/172.16.100.102:9300]&quot;,
                  &quot;ip&quot;: &quot;172.16.100.102&quot;,
                  &quot;host&quot;: &quot;ConnecTome-maker&quot;,
                  &quot;ip_port&quot;: &quot;172.16.100.102:9300&quot;,
                  &quot;master_node&quot;: true,
                  &quot;data_node&quot;: true,
                  &quot;master&quot;: true
               },
               &quot;indices&quot;: {
                  &quot;docs&quot;: {
                     &quot;count&quot;: 32423,
                     &quot;deleted&quot;: 5032
                  },
                  &quot;store&quot;: {
                     &quot;size_in_bytes&quot;: 18374197,
                     &quot;throttle_time_in_millis&quot;: 0
                  },
                  &quot;indexing&quot;: {
                     &quot;index_total&quot;: 0,
                     &quot;index_time_in_millis&quot;: 0,
                     &quot;index_current&quot;: 0,
                     &quot;delete_total&quot;: 0,
                     &quot;delete_time_in_millis&quot;: 0,
                     &quot;delete_current&quot;: 0,
                     &quot;noop_update_total&quot;: 0,
                     &quot;is_throttled&quot;: false,
                     &quot;throttle_time_in_millis&quot;: 0
                  },
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 4,
   "timed_out": false,
   "_shards": {
      "total": 28,
      "successful": 28,
      "failed": 0
   },
   "hits": {
      "total": 692211,
      "max_score": 1,
      "hits": [
         {
            "_index": ".marvel-2014.12.03",
            "_type": "node_stats",
            "_id": "AUoQL90PWVwb65544Xyb",
            "_score": 1,
            "_source": {
               "@timestamp": "2014-12-03T12:46:19.677Z",
               "cluster_name": "elasticsearch",
               "node": {
                  "id": "b-I02eBqQqCgp7hZaezZpw",
                  "name": "Geirrodur",
                  "transport_address": "inet[/172.16.100.102:9300]",
                  "ip": "172.16.100.102",
                  "host": "ConnecTome-maker",
                  "ip_port": "172.16.100.102:9300",
                  "master_node": true,
                  "data_node": true,
                  "master": true
               },
               "indices": {
                  "docs": {
                     "count": 32423,
                     "deleted": 5032
                  },
                  "store": {
                     "size_in_bytes": 18374197,
                     "throttle_time_in_millis": 0
                  },
                  "indexing": {
                     "index_total": 0,
                     "index_time_in_millis": 0,
                     "index_current": 0,
                     "delete_total": 0,
                     "delete_time_in_millis": 0,
                     "delete_current": 0,
                     "noop_update_total": 0,
                     "is_throttled": false,
                     "throttle_time_in_millis": 0
                  },
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/_search
{
  &quot;size&quot;: 1000,
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/_search
{
  "size": 1000,
  "query": {
    "match_all": {}
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 32,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 259748,
      &quot;max_score&quot;: 1,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141205&quot;,
            &quot;_type&quot;: &quot;osfound&quot;,
            &quot;_id&quot;: &quot;CzJQ1R2yS4P08omf5d&quot;,
            &quot;_score&quot;: 1,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141205000053&quot;,
               &quot;device_ip&quot;: &quot;172.16.2.3&quot;,
               &quot;uid&quot;: &quot;CzJQ1R2yS4P08omf5d&quot;,
               &quot;os_ip&quot;: &quot;192.168.1.29&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-05T00:00:53+00:00&quot;,
               &quot;elastic_time&quot;: &quot;20141205000104&quot;,
               &quot;log_type_Name&quot;: &quot;osfound.log&quot;,
               &quot;eps_time&quot;: &quot;1417705253.594825&quot;,
               &quot;os_type&quot;: &quot;[genre=Windows, detail=2000 SP2+, XP SP1+ (seldom 98), Vista SP1, 7 SP1, 2008 SP2, dist=0, match_type=direct_inference]&quot;
            }
         },
         {
            &quot;_index&quot;: &quot;connectome-20141205&quot;,
            &quot;_type&quot;: &quot;osfound&quot;,
            &quot;_id&quot;: &quot;CAk4Nc2xsOyIIX80li&quot;,
            &quot;_score&quot;: 1,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141205000059&quot;,
               &quot;device_ip&quot;: &quot;172.16.2.3&quot;,
               &quot;uid&quot;: &quot;CAk4Nc2xsOyIIX80li&quot;,
               &quot;os_ip&quot;: &quot;192.168.1.29&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-05T00:00:59+00:00&quot;,
               &quot;elastic_time&quot;: &quot;20141205000104&quot;,
               &quot;log_type_Name&quot;: &quot;osfound.log&quot;,
               &quot;eps_time&quot;: &quot;1417705259.407321&quot;,
               &quot;os_type&quot;: &quot;[genre=Windows, detail=2000 SP2+, XP SP1+ (seldom 98), Vista SP1, 7 SP1, 2008 SP2, dist=0, match_type=direct_inference]&quot;
            }
         },
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 32,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 259748,
      "max_score": 1,
      "hits": [
         {
            "_index": "connectome-20141205",
            "_type": "osfound",
            "_id": "CzJQ1R2yS4P08omf5d",
            "_score": 1,
            "_source": {
               "report_time": "20141205000053",
               "device_ip": "172.16.2.3",
               "uid": "CzJQ1R2yS4P08omf5d",
               "os_ip": "192.168.1.29",
               "@timestamp": "2014-12-05T00:00:53+00:00",
               "elastic_time": "20141205000104",
               "log_type_Name": "osfound.log",
               "eps_time": "1417705253.594825",
               "os_type": "[genre=Windows, detail=2000 SP2+, XP SP1+ (seldom 98), Vista SP1, 7 SP1, 2008 SP2, dist=0, match_type=direct_inference]"
            }
         },
         {
            "_index": "connectome-20141205",
            "_type": "osfound",
            "_id": "CAk4Nc2xsOyIIX80li",
            "_score": 1,
            "_source": {
               "report_time": "20141205000059",
               "device_ip": "172.16.2.3",
               "uid": "CAk4Nc2xsOyIIX80li",
               "os_ip": "192.168.1.29",
               "@timestamp": "2014-12-05T00:00:59+00:00",
               "elastic_time": "20141205000104",
               "log_type_Name": "osfound.log",
               "eps_time": "1417705259.407321",
               "os_type": "[genre=Windows, detail=2000 SP2+, XP SP1+ (seldom 98), Vista SP1, 7 SP1, 2008 SP2, dist=0, match_type=direct_inference]"
            }
         },
</code></pre><h4 id="term-query"><a name="term-query" href="#term-query"></a>term query</h4><ul>
<li>term은 형태소 분석을 통해 추출된 색인어로, 검색 시 입력한 질이어와는 다르다.</li>
<li>lowercase filter가 적용되기 때문에(stanard_analyzer) 질이어로 사용하는 텍스트는 소문자여야 하고, 대문자로 입력하면 검색되지 않는다.</li>
<li>당연히 ‘korea republic’ 이나 ‘repu’ 등으로 검색 되지 않으며, *(Asterisk)등의 기호도 사용할 수 없다.<pre><code data-origin="&lt;pre&gt;&lt;code&gt;$ curl -XGET 'http://localhost:9200/connectome-20141202/conn/_search?pretty' -d '{
  &quot;query&quot; : {
      &quot;term&quot; : { &quot;src_ip&quot; : &quot;192.168.1.151&quot; }
  }
}
'
&lt;/code&gt;&lt;/pre&gt;">$ curl -XGET 'http://localhost:9200/connectome-20141202/conn/_search?pretty' -d '{
  "query" : {
      "term" : { "src_ip" : "192.168.1.151" }
  }
}
'
</code></pre><code>Result</code><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
 &quot;took&quot;: 3,
 &quot;timed_out&quot;: false,
 &quot;_shards&quot;: {
    &quot;total&quot;: 1,
    &quot;successful&quot;: 1,
    &quot;failed&quot;: 0
 },
 &quot;hits&quot;: {
    &quot;total&quot;: 11073,
    &quot;max_score&quot;: 5.6057773,
    &quot;hits&quot;: [
       {
          &quot;_index&quot;: &quot;connectome-20141202&quot;,
          &quot;_type&quot;: &quot;conn&quot;,
          &quot;_id&quot;: &quot;Cqs6Oc2M1i18Ox7jv6&quot;,
          &quot;_score&quot;: 5.6057773,
          &quot;_source&quot;: {
             &quot;report_time&quot;: &quot;20141202100458&quot;,
             &quot;src_bytes&quot;: &quot;2190&quot;,
             &quot;uid&quot;: &quot;Cqs6Oc2M1i18Ox7jv6&quot;,
             &quot;src_asname&quot;: &quot;unknown-0&quot;,
             &quot;@timestamp&quot;: &quot;2014-12-02T10:04:58+00:00&quot;,
             &quot;resp_cname&quot;: &quot;United States&quot;,
             &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
             &quot;dst_ip_bytes&quot;: &quot;2436&quot;,
             &quot;dst_asn&quot;: &quot;15169&quot;,
             &quot;dst_asname&quot;: &quot;Google Inc.&quot;,
             &quot;duration&quot;: &quot;0.458304&quot;,
             &quot;src_lati&quot;: &quot;0.0&quot;,
             &quot;src_port&quot;: &quot;49375&quot;,
             &quot;src_country_name&quot;: &quot;unknown-&quot;,
             &quot;conn_state&quot;: &quot;SF&quot;,
             &quot;pcr&quot;: &quot;0.055422&quot;,
             &quot;elastic_time&quot;: &quot;20141202100925&quot;,
             &quot;src_asn&quot;: &quot;0&quot;,
             &quot;src_ip&quot;: &quot;192.168.1.151&quot;,
             &quot;src_cc&quot;: &quot;(empty)&quot;,
             &quot;src_pkts&quot;: &quot;16&quot;,
             &quot;dst_long&quot;: &quot;-122.057404&quot;,
             &quot;dst_cc&quot;: &quot;US&quot;,
             &quot;device_ip&quot;: &quot;172.16.2.3&quot;,
             &quot;prtc&quot;: &quot;tcp&quot;,
             &quot;dst_lati&quot;: &quot;37.419201&quot;,
             &quot;missed_bytes&quot;: &quot;0&quot;,
             &quot;app_prtc&quot;: &quot;ssl&quot;,
             &quot;conn_local&quot;: &quot;T&quot;,
             &quot;dst_pkts&quot;: &quot;9&quot;,
             &quot;log_type_Name&quot;: &quot;conn.log&quot;,
             &quot;src_long&quot;: &quot;0.0&quot;,
             &quot;eps_time&quot;: &quot;1417482298.255246&quot;,
             &quot;dst_port&quot;: &quot;443&quot;,
             &quot;dst_ip&quot;: &quot;173.194.117.225&quot;,
             &quot;src_ip_bytes&quot;: &quot;3034&quot;,
             &quot;dst_bytes&quot;: &quot;1960&quot;,
             &quot;history&quot;: &quot;ShADadFf&quot;
          }
       },
&lt;/code&gt;&lt;/pre&gt;">{
 "took": 3,
 "timed_out": false,
 "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
 },
 "hits": {
    "total": 11073,
    "max_score": 5.6057773,
    "hits": [
       {
          "_index": "connectome-20141202",
          "_type": "conn",
          "_id": "Cqs6Oc2M1i18Ox7jv6",
          "_score": 5.6057773,
          "_source": {
             "report_time": "20141202100458",
             "src_bytes": "2190",
             "uid": "Cqs6Oc2M1i18Ox7jv6",
             "src_asname": "unknown-0",
             "@timestamp": "2014-12-02T10:04:58+00:00",
             "resp_cname": "United States",
             "tunnel_parents": "(empty)",
             "dst_ip_bytes": "2436",
             "dst_asn": "15169",
             "dst_asname": "Google Inc.",
             "duration": "0.458304",
             "src_lati": "0.0",
             "src_port": "49375",
             "src_country_name": "unknown-",
             "conn_state": "SF",
             "pcr": "0.055422",
             "elastic_time": "20141202100925",
             "src_asn": "0",
             "src_ip": "192.168.1.151",
             "src_cc": "(empty)",
             "src_pkts": "16",
             "dst_long": "-122.057404",
             "dst_cc": "US",
             "device_ip": "172.16.2.3",
             "prtc": "tcp",
             "dst_lati": "37.419201",
             "missed_bytes": "0",
             "app_prtc": "ssl",
             "conn_local": "T",
             "dst_pkts": "9",
             "log_type_Name": "conn.log",
             "src_long": "0.0",
             "eps_time": "1417482298.255246",
             "dst_port": "443",
             "dst_ip": "173.194.117.225",
             "src_ip_bytes": "3034",
             "dst_bytes": "1960",
             "history": "ShADadFf"
          }
       },
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141202/conn/_search?pretty
{   &quot;size&quot;: 100,
  &quot;from&quot;: 0,
  &quot;fields&quot;: [&quot;report_time&quot;,&quot;src_ip&quot;, &quot;dst_ip&quot;, &quot;pcr&quot;],
  &quot;sort&quot;: [
    {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      },
       &quot;src_ip&quot;: {
        &quot;order&quot;: &quot;asc&quot;
      }
    }
  ],
  &quot;query&quot; : {
      &quot;term&quot; : { &quot;src_ip&quot; : &quot;192.168.1.151&quot; }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141202/conn/_search?pretty
{   "size": 100,
  "from": 0,
  "fields": ["report_time","src_ip", "dst_ip", "pcr"],
  "sort": [
    {
      "report_time": {
        "order": "desc"
      },
       "src_ip": {
        "order": "asc"
      }
    }
  ],
  "query" : {
      "term" : { "src_ip" : "192.168.1.151" }
  }
}
</code></pre><code>Result</code><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
 &quot;took&quot;: 10,
 &quot;timed_out&quot;: false,
 &quot;_shards&quot;: {
    &quot;total&quot;: 1,
    &quot;successful&quot;: 1,
    &quot;failed&quot;: 0
 },
 &quot;hits&quot;: {
    &quot;total&quot;: 11114,
    &quot;max_score&quot;: null,
    &quot;hits&quot;: [
       {
          &quot;_index&quot;: &quot;connectome-20141202&quot;,
          &quot;_type&quot;: &quot;conn&quot;,
          &quot;_id&quot;: &quot;CIUcj8314cEm7xWo5d&quot;,
          &quot;_score&quot;: null,
          &quot;fields&quot;: {
             &quot;report_time&quot;: [
                &quot;20141202171656&quot;
             ],
             &quot;pcr&quot;: [
                &quot;-0.786848&quot;
             ],
             &quot;src_ip&quot;: [
                &quot;192.168.1.151&quot;
             ],
             &quot;dst_ip&quot;: [
                &quot;172.16.3.6&quot;
             ]
          },
          &quot;sort&quot;: [
             &quot;20141202171656&quot;,
             &quot;192.168.1.151&quot;
          ]
       },
       {
          &quot;_index&quot;: &quot;connectome-20141202&quot;,
          &quot;_type&quot;: &quot;conn&quot;,
          &quot;_id&quot;: &quot;COkARS1if8sGEZECH8&quot;,
          &quot;_score&quot;: null,
          &quot;fields&quot;: {
             &quot;report_time&quot;: [
                &quot;20141202171655&quot;
             ],
             &quot;pcr&quot;: [
                &quot;-0.801453&quot;
             ],
             &quot;src_ip&quot;: [
                &quot;192.168.1.151&quot;
             ],
             &quot;dst_ip&quot;: [
                &quot;172.16.3.6&quot;
             ]
          },
          &quot;sort&quot;: [
             &quot;20141202171655&quot;,
             &quot;192.168.1.151&quot;
          ]
       },
&lt;/code&gt;&lt;/pre&gt;">{
 "took": 10,
 "timed_out": false,
 "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
 },
 "hits": {
    "total": 11114,
    "max_score": null,
    "hits": [
       {
          "_index": "connectome-20141202",
          "_type": "conn",
          "_id": "CIUcj8314cEm7xWo5d",
          "_score": null,
          "fields": {
             "report_time": [
                "20141202171656"
             ],
             "pcr": [
                "-0.786848"
             ],
             "src_ip": [
                "192.168.1.151"
             ],
             "dst_ip": [
                "172.16.3.6"
             ]
          },
          "sort": [
             "20141202171656",
             "192.168.1.151"
          ]
       },
       {
          "_index": "connectome-20141202",
          "_type": "conn",
          "_id": "COkARS1if8sGEZECH8",
          "_score": null,
          "fields": {
             "report_time": [
                "20141202171655"
             ],
             "pcr": [
                "-0.801453"
             ],
             "src_ip": [
                "192.168.1.151"
             ],
             "dst_ip": [
                "172.16.3.6"
             ]
          },
          "sort": [
             "20141202171655",
             "192.168.1.151"
          ]
       },
</code></pre></li>
<li>대문자 Korea는 검색 되지 않음</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;term&quot; : {
          &quot;resp_cname&quot; : &quot;Korea&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "term" : {
          "resp_cname" : "Korea"
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 1,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 0,
      &quot;max_score&quot;: null,
      &quot;hits&quot;: []
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 1,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 0,
      "max_score": null,
      "hits": []
   }
}
</code></pre><ul>
<li>소문자 korea로 검색</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;term&quot; : {
          &quot;resp_cname&quot; : &quot;korea&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "term" : {
          "resp_cname" : "korea"
    }
  }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 1,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 10197,
      &quot;max_score&quot;: 1.3142498,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141207&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;C8I0X31gLW8wwxBON&quot;,
            &quot;_score&quot;: 1.3142498,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141207000746&quot;,
               &quot;src_bytes&quot;: 659,
               &quot;uid&quot;: &quot;C8I0X31gLW8wwxBON&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-07T00:07:46+00:00&quot;,
               &quot;resp_cname&quot;: &quot;Korea Republic of&quot;,
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 1,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 10197,
      "max_score": 1.3142498,
      "hits": [
         {
            "_index": "connectome-20141207",
            "_type": "conn",
            "_id": "C8I0X31gLW8wwxBON",
            "_score": 1.3142498,
            "_source": {
               "report_time": "20141207000746",
               "src_bytes": 659,
               "uid": "C8I0X31gLW8wwxBON",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-07T00:07:46+00:00",
               "resp_cname": "Korea Republic of",
</code></pre><h4 id="terms-query"><a name="terms-query" href="#terms-query"></a>terms query</h4><ul>
<li>term와 같은 쿼리로 대상 필드에 복수 개의 term이 포함된 도큐먼트를 검색한다. 이 쿼리는 mininum match설정을 통해 AND와 OR연산을 적용할 수 있다.</li>
<li>여러개의 term이 모두 포함된 문서만 찾고 싶으면 minimum_match를 term크기만큼 지정하고, 그 중 하나의 term이라도 포함된 문서를 찾고 싶다면 minumum_match를 1로 설정한다.</li>
<li>아래는 별 의미없는 샘플 예제, src_ip는 어짜피 하나만 존재한다.</li>
</ul><p><code>example</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;terms&quot; : {
          &quot;src_ip&quot; : [&quot;192.168.1.31&quot;],
          &quot;minimum_match&quot;: 1
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "terms" : {
          "src_ip" : ["192.168.1.31"],
          "minimum_match": 1
    }
  }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 2,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 3780,
      &quot;max_score&quot;: 3.4575784,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141207&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CBuVoZ2Wh9ur427PNd&quot;,
            &quot;_score&quot;: 3.4575784,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141207000401&quot;,
               &quot;src_bytes&quot;: -1,
               &quot;uid&quot;: &quot;CBuVoZ2Wh9ur427PNd&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-07T00:04:01+00:00&quot;,
               &quot;resp_cname&quot;: &quot;unknown-&quot;,
               &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 2,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 3780,
      "max_score": 3.4575784,
      "hits": [
         {
            "_index": "connectome-20141207",
            "_type": "conn",
            "_id": "CBuVoZ2Wh9ur427PNd",
            "_score": 3.4575784,
            "_source": {
               "report_time": "20141207000401",
               "src_bytes": -1,
               "uid": "CBuVoZ2Wh9ur427PNd",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-07T00:04:01+00:00",
               "resp_cname": "unknown-",
               "tunnel_parents": "(empty)",
</code></pre><ul>
<li>term와 같은 원리로 대문자로 검색할 수 없음, terms쿼리는 반드시 배열로 지정하여야 검색 가능함</li>
<li>“Korea Republic of”에 대해서 모두 포함되어 있는 문서를 검색시 배열에 모두 포함시켜 주고 minumum_match를 3으로 설정함, 그렇다고 해서 exact match 검색은 아님, 중복, 순서가 고려되지 않음</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;terms&quot; : {
          &quot;resp_cname&quot; : [&quot;korea&quot;],
          &quot;minimum_match&quot;: 1
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "terms" : {
          "resp_cname" : ["korea"],
          "minimum_match": 1
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 4,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 10731,
      &quot;max_score&quot;: null,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141207&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CfQi1x3CHSfblLqkm9&quot;,
            &quot;_score&quot;: null,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141207001723&quot;,
               &quot;src_bytes&quot;: 2117,
               &quot;uid&quot;: &quot;CfQi1x3CHSfblLqkm9&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-07T00:17:23+00:00&quot;,
               &quot;resp_cname&quot;: &quot;Korea Republic of&quot;,
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 4,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 10731,
      "max_score": null,
      "hits": [
         {
            "_index": "connectome-20141207",
            "_type": "conn",
            "_id": "CfQi1x3CHSfblLqkm9",
            "_score": null,
            "_source": {
               "report_time": "20141207001723",
               "src_bytes": 2117,
               "uid": "CfQi1x3CHSfblLqkm9",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-07T00:17:23+00:00",
               "resp_cname": "Korea Republic of",
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;terms&quot; : {
          &quot;resp_cname&quot; : [&quot;korea&quot;, &quot;republic&quot;, &quot;fighting&quot;],
          &quot;minimum_match&quot;: 1
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "terms" : {
          "resp_cname" : ["korea", "republic", "fighting"],
          "minimum_match": 1
    }
  }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;terms&quot; : {
          &quot;resp_cname&quot; : [&quot;korea&quot;, &quot;republic&quot;, &quot;fighting&quot;],
          &quot;minimum_match&quot;: 2
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "terms" : {
          "resp_cname" : ["korea", "republic", "fighting"],
          "minimum_match": 2
    }
  }
}
</code></pre><h4 id="match-query"><a name="match-query" href="#match-query"></a>match query</h4><ul>
<li>term쿼리와 비슷한 기능으로, 지정한 필드에서 Query String형태로 문서를 검색한다.</li>
<li>term쿼리와는 다르게 쿼리에 대해서 분석 작업이 필요하다.(search_analyzer)</li>
<li>search_analyzer는 기본적으로 lowercase filter가 동작하므로 대문자로 검색이 가능하다.</li>
<li>아래는 별 의미없는 샘플 예제, src_ip는 어짜피 하나만 존재한다.(sorting 예제 포함)</li>
<li>*(Asterisk) 문자 사용 불가능</li>
</ul><p><code>example</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;src_ip&quot; : &quot;192.168.1.31&quot;
    }
  },
  &quot;sort&quot;: [
    {
      &quot;app_prtc&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    },
     {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;acs&quot;
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "match" : {
          "src_ip" : "192.168.1.31"
    }
  },
  "sort": [
    {
      "app_prtc": {
        "order": "desc"
      }
    },
     {
      "report_time": {
        "order": "acs"
      }
    }
  ]
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 9,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 3558,
      &quot;max_score&quot;: null,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141207&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CN2zka48CQOjR0ksCe&quot;,
            &quot;_score&quot;: null,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141207005829&quot;,
               &quot;src_bytes&quot;: 7503,
               &quot;uid&quot;: &quot;CN2zka48CQOjR0ksCe&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-07T00:58:29+00:00&quot;,
               &quot;resp_cname&quot;: &quot;United States&quot;,
               &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
               &quot;dst_ip_bytes&quot;: 16577,
               &quot;dst_asn&quot;: 8075,
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 9,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 3558,
      "max_score": null,
      "hits": [
         {
            "_index": "connectome-20141207",
            "_type": "conn",
            "_id": "CN2zka48CQOjR0ksCe",
            "_score": null,
            "_source": {
               "report_time": "20141207005829",
               "src_bytes": 7503,
               "uid": "CN2zka48CQOjR0ksCe",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-07T00:58:29+00:00",
               "resp_cname": "United States",
               "tunnel_parents": "(empty)",
               "dst_ip_bytes": 16577,
               "dst_asn": 8075,
</code></pre><ul>
<li>operator를 지정하지 않으면 기본적으로 or연산자가 적용</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;resp_cname&quot; : &quot;Korea Republic&quot;
    }
  },
  &quot;sort&quot;: [
    {
      &quot;app_prtc&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    },
     {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;acs&quot;
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "match" : {
          "resp_cname" : "Korea Republic"
    }
  },
  "sort": [
    {
      "app_prtc": {
        "order": "desc"
      }
    },
     {
      "report_time": {
        "order": "acs"
      }
    }
  ]
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;resp_cname&quot; : &quot;Korea fighting&quot;
    }
  },
  &quot;sort&quot;: [
    {
      &quot;app_prtc&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    },
     {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;acs&quot;
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "match" : {
          "resp_cname" : "Korea fighting"
    }
  },
  "sort": [
    {
      "app_prtc": {
        "order": "desc"
      }
    },
     {
      "report_time": {
        "order": "acs"
      }
    }
  ]
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;resp_cname&quot; : {
            &quot;query&quot;: &quot;Korea&quot;,
            &quot;operator&quot;: &quot;and&quot;
          }
    }
  },
  &quot;sort&quot;: [
    {
      &quot;app_prtc&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    },
     {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;acs&quot;
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "match" : {
          "resp_cname" : {
            "query": "Korea",
            "operator": "and"
          }
    }
  },
  "sort": [
    {
      "app_prtc": {
        "order": "desc"
      }
    },
     {
      "report_time": {
        "order": "acs"
      }
    }
  ]
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;resp_cname&quot; : {
            &quot;query&quot;: &quot;Korea&quot;,
            &quot;operator&quot;: &quot;or&quot;
          }
    }
  },
  &quot;sort&quot;: [
    {
      &quot;app_prtc&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    },
     {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;acs&quot;
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "match" : {
          "resp_cname" : {
            "query": "Korea",
            "operator": "or"
          }
    }
  },
  "sort": [
    {
      "app_prtc": {
        "order": "desc"
      }
    },
     {
      "report_time": {
        "order": "acs"
      }
    }
  ]
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;resp_cname&quot; : {
            &quot;query&quot;: &quot;Korea Republic&quot;,
            &quot;operator&quot;: &quot;and&quot;
          }
    }
  },
  &quot;sort&quot;: [
    {
      &quot;app_prtc&quot;: {
        &quot;order&quot;: &quot;desc&quot;
      }
    },
     {
      &quot;report_time&quot;: {
        &quot;order&quot;: &quot;acs&quot;
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query" : {
    "match" : {
          "resp_cname" : {
            "query": "Korea Republic",
            "operator": "and"
          }
    }
  },
  "sort": [
    {
      "app_prtc": {
        "order": "desc"
      }
    },
     {
      "report_time": {
        "order": "acs"
      }
    }
  ]
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141206/conn/_search
{
  &quot;query&quot; : {
    &quot;match&quot; : {
          &quot;history&quot; : {
               &quot;query&quot;: &quot;S D&quot;,
               &quot;operator&quot;: &quot;or&quot;
          }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141206/conn/_search
{
  "query" : {
    "match" : {
          "history" : {
               "query": "S D",
               "operator": "or"
          }
    }
  }
}
</code></pre><h4 id="multi-match-query"><a name="multi-match-query" href="#multi-match-query"></a>multi match query</h4><ul>
<li>match쿼리와 방법은 같으나 하나의 필드가 아니라 여러 개의 필드에서 쿼리 스트링으로 검색한다.</li>
<li>operator는 match와 같이 query에 적용된다.</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/conn/_search
{ &quot;query&quot;: {
      &quot;multi_match&quot;: {
        &quot;query&quot;: &quot;192.168.1.31 172.16.1.150&quot;,
        &quot;fields&quot;: [&quot;src_ip&quot;, &quot;dst_ip&quot;],
        &quot;operator&quot; : &quot;or&quot;
    }
  },
  &quot;size&quot;: 1000
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/conn/_search
{ "query": {
      "multi_match": {
        "query": "192.168.1.31 172.16.1.150",
        "fields": ["src_ip", "dst_ip"],
        "operator" : "or"
    }
  },
  "size": 1000
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 24,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 12154,
      &quot;max_score&quot;: 2.221059,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141205&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;Cv3dg31Fh1PcrolWF9&quot;,
            &quot;_score&quot;: 2.221059,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141205010153&quot;,
               &quot;src_bytes&quot;: 96,
               &quot;uid&quot;: &quot;Cv3dg31Fh1PcrolWF9&quot;,
               &quot;src_asname&quot;: &quot;Korea Telecom&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-05T01:01:53+00:00&quot;,
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 24,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 12154,
      "max_score": 2.221059,
      "hits": [
         {
            "_index": "connectome-20141205",
            "_type": "conn",
            "_id": "Cv3dg31Fh1PcrolWF9",
            "_score": 2.221059,
            "_source": {
               "report_time": "20141205010153",
               "src_bytes": 96,
               "uid": "Cv3dg31Fh1PcrolWF9",
               "src_asname": "Korea Telecom",
               "@timestamp": "2014-12-05T01:01:53+00:00",
</code></pre><h4 id="query-string-query"><a name="query-string-query" href="#query-string-query"></a>Query String Query</h4><ul>
<li>전통으로 많이 사용하는 쿼리로, 대상 필드에 쿼리 스트링 질의로 문서를 검색한다.</li>
<li>search uri나 Query String Query로 할 수 있는 것들을 우선 사용하자</li>
<li>term/terms, match/multi-match는 이런게 있다는 것만 알아두자</li>
<li>Lucene의 Query Parser Syntax를 사용한다.</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/conn/_search
{ &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;query&quot;: &quot;*:*&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/conn/_search
{ "query": {
      "query_string": {
        "query": "*:*"
    }
  }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/conn/_search
{ &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;default_field&quot;: &quot;src_ip&quot;,
        &quot;query&quot;: &quot;192.168.1.29&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/conn/_search
{ "query": {
      "query_string": {
        "default_field": "src_ip",
        "query": "192.168.1.29"
    }
  }
}
</code></pre><ul>
<li><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html">elasticsearch.com</a> 페이지에서는 같다고 하였는데 실제 다르게 나옴, 검증이 필요함</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/conn/_search
{ &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;fields&quot;: [&quot;src_ip&quot;, &quot;dst_ip&quot;],
        &quot;query&quot;: &quot;192.168.* AND 172.16.*&quot;
    }
  },
  &quot;size&quot;: 1000
}

GET /connectome-20141205/conn/_search
{ &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;query&quot;: &quot;(src_ip:192.168.* OR src_ip:172.16.*) AND (dst_ip:192.168.* OR dst_ip:172.16.*)&quot;
    }
  },
  &quot;size&quot;: 1000
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/conn/_search
{ "query": {
      "query_string": {
        "fields": ["src_ip", "dst_ip"],
        "query": "192.168.* AND 172.16.*"
    }
  },
  "size": 1000
}

GET /connectome-20141205/conn/_search
{ "query": {
      "query_string": {
        "query": "(src_ip:192.168.* OR src_ip:172.16.*) AND (dst_ip:192.168.* OR dst_ip:172.16.*)"
    }
  },
  "size": 1000
}
</code></pre><h4 id="identifiers-query"><a name="identifiers-query" href="#identifiers-query"></a>Identifiers Query</h4><ul>
<li>unique id 즉 _id 값을 이용해서 세부정보를 가장 빠르게 가져올 수 있는 쿼리</li>
<li>index속성이 not_analyze되어 있어야 함</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/_search
{
  &quot;query&quot; : {
    &quot;ids&quot;: {
      &quot;type&quot; : &quot;conn&quot;,
      &quot;values&quot;: [&quot;Cob3ol2UHf9asdfsp6&quot;]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/_search
{
  "query" : {
    "ids": {
      "type" : "conn",
      "values": ["Cob3ol2UHf9asdfsp6"]
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 1,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 1,
      &quot;max_score&quot;: 1,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141205&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;Cob3ol2UHf9asdfsp6&quot;,
            &quot;_score&quot;: 1,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141205000741&quot;,
               &quot;src_bytes&quot;: 68,
               &quot;uid&quot;: &quot;Cob3ol2UHf9asdfsp6&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-05T00:07:41+00:00&quot;,
               &quot;resp_cname&quot;: &quot;unknown-&quot;,
               &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
               &quot;dst_ip_bytes&quot;: 80,
               &quot;dst_asn&quot;: 0,
               &quot;dst_asname&quot;: &quot;unknown-0&quot;,
               &quot;duration&quot;: 0.000072,
               &quot;src_lati&quot;: 0,
               &quot;src_port&quot;: &quot;123&quot;,
               &quot;src_country_name&quot;: &quot;unknown-&quot;,
               &quot;conn_state&quot;: &quot;SF&quot;,
               &quot;pcr&quot;: 0.133333,
               &quot;elastic_time&quot;: &quot;20141205000856&quot;,
               &quot;src_asn&quot;: 0,
               &quot;src_ip&quot;: &quot;192.168.1.55&quot;,
               &quot;src_cc&quot;: &quot;(empty)&quot;,
               &quot;src_pkts&quot;: 1,
               &quot;dst_long&quot;: 0,
               &quot;dst_cc&quot;: &quot;(empty)&quot;,
               &quot;device_ip&quot;: &quot;172.16.2.3&quot;,
               &quot;prtc&quot;: &quot;udp&quot;,
               &quot;dst_lati&quot;: 0,
               &quot;missed_bytes&quot;: 0,
               &quot;app_prtc&quot;: &quot;-&quot;,
               &quot;conn_local&quot;: &quot;T&quot;,
               &quot;dst_pkts&quot;: 1,
               &quot;log_type_Name&quot;: &quot;conn.log&quot;,
               &quot;src_long&quot;: 0,
               &quot;eps_time&quot;: &quot;1417705661.256349&quot;,
               &quot;dst_port&quot;: &quot;123&quot;,
               &quot;dst_ip&quot;: &quot;172.16.1.150&quot;,
               &quot;src_ip_bytes&quot;: 96,
               &quot;dst_bytes&quot;: 52,
               &quot;history&quot;: &quot;Dd&quot;
            }
         }
      ]
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 1,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 1,
      "max_score": 1,
      "hits": [
         {
            "_index": "connectome-20141205",
            "_type": "conn",
            "_id": "Cob3ol2UHf9asdfsp6",
            "_score": 1,
            "_source": {
               "report_time": "20141205000741",
               "src_bytes": 68,
               "uid": "Cob3ol2UHf9asdfsp6",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-05T00:07:41+00:00",
               "resp_cname": "unknown-",
               "tunnel_parents": "(empty)",
               "dst_ip_bytes": 80,
               "dst_asn": 0,
               "dst_asname": "unknown-0",
               "duration": 0.000072,
               "src_lati": 0,
               "src_port": "123",
               "src_country_name": "unknown-",
               "conn_state": "SF",
               "pcr": 0.133333,
               "elastic_time": "20141205000856",
               "src_asn": 0,
               "src_ip": "192.168.1.55",
               "src_cc": "(empty)",
               "src_pkts": 1,
               "dst_long": 0,
               "dst_cc": "(empty)",
               "device_ip": "172.16.2.3",
               "prtc": "udp",
               "dst_lati": 0,
               "missed_bytes": 0,
               "app_prtc": "-",
               "conn_local": "T",
               "dst_pkts": 1,
               "log_type_Name": "conn.log",
               "src_long": 0,
               "eps_time": "1417705661.256349",
               "dst_port": "123",
               "dst_ip": "172.16.1.150",
               "src_ip_bytes": 96,
               "dst_bytes": 52,
               "history": "Dd"
            }
         }
      ]
   }
}
</code></pre><h4 id="prefix-query"><a name="prefix-query" href="#prefix-query"></a>Prefix Query</h4><ul>
<li>Text의 앞 문자열에 대한 term의 일치 여부에 따라 검색 결과를 가져옴</li>
<li>검색 대상 필드는 인덱스 속성이 not_analyzed로 설정되어야 함</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{
  &quot;query&quot;: {
    &quot;prefix&quot; : {
      &quot;src_ip&quot;: {
        &quot;value&quot; : &quot;172.16.&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{
  "query": {
    "prefix" : {
      "src_ip": {
        "value" : "172.16."
      }
    }
  }
}
</code></pre><h4 id="match-all-query"><a name="match-all-query" href="#match-all-query"></a>Match All Query</h4><ul>
<li>이 쿼리는 “SELECT * FROM TABLE” SQL처럼 모든 도큐먼트를 구해오는 쿼리</li>
<li>검색서비스에서는 거의 사용하지 않고, 보통 관리 목적으로 사용함</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET _search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET _search
{
  "query": {
    "match_all": {}
  }
}
</code></pre><h4 id="range-query"><a name="range-query" href="#range-query"></a>Range Query</h4><ul>
<li>term쿼리에 유사하게 많이 사용하는 형태</li>
<li>number, date, ip 등의 datatype에 대해서 효과적으로 사용할 수 있다.</li>
<li>not_analyzed로 설정되어야 사용 가능하다.</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;query&quot;: {
    &quot;range&quot;: {
      &quot;duration&quot;: {
        &quot;gte&quot;: 2000,
        &quot;lte&quot;: 3000
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "query": {
    "range": {
      "duration": {
        "gte": 2000,
        "lte": 3000
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 2,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 7,
      &quot;max_score&quot;: 1,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141207&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;Cq6Xe14zMRdTro9C4c&quot;,
            &quot;_score&quot;: 1,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141207064839&quot;,
               &quot;src_bytes&quot;: 6044,
               &quot;uid&quot;: &quot;Cq6Xe14zMRdTro9C4c&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-07T06:48:39+00:00&quot;,
               &quot;resp_cname&quot;: &quot;United States&quot;,
               &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
               &quot;dst_ip_bytes&quot;: 15219,
               &quot;dst_asn&quot;: 15169,
               &quot;dst_asname&quot;: &quot;Google Inc.&quot;,
               &quot;duration&quot;: 2100.135519,
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 2,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 7,
      "max_score": 1,
      "hits": [
         {
            "_index": "connectome-20141207",
            "_type": "conn",
            "_id": "Cq6Xe14zMRdTro9C4c",
            "_score": 1,
            "_source": {
               "report_time": "20141207064839",
               "src_bytes": 6044,
               "uid": "Cq6Xe14zMRdTro9C4c",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-07T06:48:39+00:00",
               "resp_cname": "United States",
               "tunnel_parents": "(empty)",
               "dst_ip_bytes": 15219,
               "dst_asn": 15169,
               "dst_asname": "Google Inc.",
               "duration": 2100.135519,
</code></pre><h3 id="aggregations"><a name="aggregations" href="#aggregations"></a>aggregations</h3><h4 id="terms-aggregation"><a name="terms-aggregation" href="#terms-aggregation"></a>terms aggregation</h4><ul>
<li>group by 형태의 검색</li>
<li>앞쪽에 size:0 이 지정되지 않으면 기본적으로 10개의 document가 출력된다.++</li>
<li>aggs에 포함된 size는 term aggregation의 경우 상위 10개만 출력됨 , 기본적으로 desc 정렬됨</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;curl -XPOST 'localhost:9200/connectome-20141029/_search?pretty' -d '
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;group_by_src_ip&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;src_ip&quot;,
        &quot;size&quot; : 0
      }
    }
  }
}'
&lt;/code&gt;&lt;/pre&gt;">curl -XPOST 'localhost:9200/connectome-20141029/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_src_ip": {
      "terms": {
        "field": "src_ip",
        "size" : 0
      }
    }
  }
}'
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;curl -XPOST 'localhost:9200/connectome-20141029/_search?pretty' -d '
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;group_by_proto&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;prtc&quot;,
        &quot;size&quot; : 0
      }
    }
  }
}'
&lt;/code&gt;&lt;/pre&gt;">curl -XPOST 'localhost:9200/connectome-20141029/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_proto": {
      "terms": {
        "field": "prtc",
        "size" : 0
      }
    }
  }
}'
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 501,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 1,
      &quot;successful&quot;: 1,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 8615647,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;group_by_proto&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: &quot;udp&quot;,
               &quot;doc_count&quot;: 1969935
            },
            {
               &quot;key&quot;: &quot;tcp&quot;,
               &quot;doc_count&quot;: 1614271
            },
            {
               &quot;key&quot;: &quot;icmp&quot;,
               &quot;doc_count&quot;: 17007
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 501,
   "timed_out": false,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "hits": {
      "total": 8615647,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "group_by_proto": {
         "buckets": [
            {
               "key": "udp",
               "doc_count": 1969935
            },
            {
               "key": "tcp",
               "doc_count": 1614271
            },
            {
               "key": "icmp",
               "doc_count": 17007
            }
         ]
      }
   }
}
</code></pre><ul>
<li>내/외부 src_ip분포</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;group_by_local&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;conn_local&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "group_by_local": {
      "terms": {
        "field": "conn_local"
      }
    }
  }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 1,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 40802,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;group_by_local&quot;: {
         &quot;doc_count_error_upper_bound&quot;: 0,
         &quot;sum_other_doc_count&quot;: 0,
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: &quot;t&quot;,
               &quot;doc_count&quot;: 37663
            },
            {
               &quot;key&quot;: &quot;f&quot;,
               &quot;doc_count&quot;: 3139
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 1,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 40802,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "group_by_local": {
         "doc_count_error_upper_bound": 0,
         "sum_other_doc_count": 0,
         "buckets": [
            {
               "key": "t",
               "doc_count": 37663
            },
            {
               "key": "f",
               "doc_count": 3139
            }
         ]
      }
   }
}
</code></pre><h4 id="min-aggregation"><a name="min-aggregation" href="#min-aggregation"></a>Min Aggregation</h4><ul>
<li>기본적으로 size를 지정하지 않으면 10개의 데이터 출력 후 sum aggregation정보 출력</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;min_duration&quot;: {
      &quot;min&quot;: {
        &quot;field&quot;: &quot;duration&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "min_duration": {
      "min": {
        "field": "duration"
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 1,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 40967,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;min_duration&quot;: {
         &quot;value&quot;: -1
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 1,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 40967,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "min_duration": {
         "value": -1
      }
   }
}
</code></pre><h4 id="max-aggregation"><a name="max-aggregation" href="#max-aggregation"></a>Max Aggregation</h4><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;max_duration&quot;: {
      &quot;max&quot;: {
        &quot;field&quot;: &quot;duration&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "max_duration": {
      "max": {
        "field": "duration"
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 9,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 41041,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;max_duration&quot;: {
         &quot;value&quot;: 36299.162081
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 9,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 41041,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "max_duration": {
         "value": 36299.162081
      }
   }
}
</code></pre><h4 id="sum-aggregation"><a name="sum-aggregation" href="#sum-aggregation"></a>Sum Aggregation</h4><pre><code data-origin="&lt;pre&gt;&lt;code&gt;POST /connectome-20141207/conn/_search?pretty
{
  &quot;aggs&quot;: {
    &quot;src_bytes_sum&quot;: {
      &quot;sum&quot;: {
        &quot;field&quot;: &quot;src_bytes&quot;
      }
    },
    &quot;dst_bytes_sum&quot;: {
      &quot;sum&quot;: {
        &quot;field&quot;: &quot;dst_bytes&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">POST /connectome-20141207/conn/_search?pretty
{
  "aggs": {
    "src_bytes_sum": {
      "sum": {
        "field": "src_bytes"
      }
    },
    "dst_bytes_sum": {
      "sum": {
        "field": "dst_bytes"
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 19,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 40186,
      &quot;max_score&quot;: 1,
      &quot;hits&quot;: [
      ]
   },
   &quot;aggregations&quot;: {
      &quot;src_bytes_sum&quot;: {
         &quot;value&quot;: 141909289
      },
      &quot;dst_bytes_sum&quot;: {
         &quot;value&quot;: 315008631
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 19,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 40186,
      "max_score": 1,
      "hits": [
      ]
   },
   "aggregations": {
      "src_bytes_sum": {
         "value": 141909289
      },
      "dst_bytes_sum": {
         "value": 315008631
      }
   }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;POST /connectome-20141207/conn/_search?pretty
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;src_bytes_sum&quot;: {
      &quot;sum&quot;: {
        &quot;field&quot;: &quot;src_bytes&quot;
      }
    },
    &quot;dst_bytes_sum&quot;: {
      &quot;sum&quot;: {
        &quot;field&quot;: &quot;dst_bytes&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">POST /connectome-20141207/conn/_search?pretty
{ "size": 0,
  "aggs": {
    "src_bytes_sum": {
      "sum": {
        "field": "src_bytes"
      }
    },
    "dst_bytes_sum": {
      "sum": {
        "field": "dst_bytes"
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 5,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 40609,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;src_bytes_sum&quot;: {
         &quot;value&quot;: 141996380
      },
      &quot;dst_bytes_sum&quot;: {
         &quot;value&quot;: 315097623
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 5,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 40609,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "src_bytes_sum": {
         "value": 141996380
      },
      "dst_bytes_sum": {
         "value": 315097623
      }
   }
}
</code></pre><h4 id="avg-aggregation"><a name="avg-aggregation" href="#avg-aggregation"></a>Avg Aggregation</h4><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;avg_duration&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;duration&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "avg_duration": {
      "avg": {
        "field": "duration"
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 18,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 41100,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;avg_duration&quot;: {
         &quot;value&quot;: 14.847179138442826
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 18,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 41100,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "avg_duration": {
         "value": 14.847179138442826
      }
   }
}
</code></pre><h4 id="stats-aggregation"><a name="stats-aggregation" href="#stats-aggregation"></a>Stats Aggregation</h4><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;stats_duration&quot;: {
      &quot;stats&quot;: {
        &quot;field&quot;: &quot;duration&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "stats_duration": {
      "stats": {
        "field": "duration"
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 20,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 41129,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;stats_duration&quot;: {
         &quot;count&quot;: 41129,
         &quot;min&quot;: -1,
         &quot;max&quot;: 36299.162081,
         &quot;avg&quot;: 14.85006427158453,
         &quot;sum&quot;: 610768.2934260002
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 20,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 41129,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "stats_duration": {
         "count": 41129,
         "min": -1,
         "max": 36299.162081,
         "avg": 14.85006427158453,
         "sum": 610768.2934260002
      }
   }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;
GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;stats_duration&quot;: {
      &quot;stats&quot;: {
        &quot;field&quot;: &quot;duration&quot;
      }
    }
  },
  &quot;query&quot;: {
    &quot;query_string&quot;: {
      &quot;query&quot;: &quot;NOT duration:(\\-1)&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">
GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "stats_duration": {
      "stats": {
        "field": "duration"
      }
    }
  },
  "query": {
    "query_string": {
      "query": "NOT duration:(\\-1)"
    }
  }
}
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 7,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 37251,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;stats_duration&quot;: {
         &quot;count&quot;: 37251,
         &quot;min&quot;: 0.000003,
         &quot;max&quot;: 36299.162081,
         &quot;avg&quot;: 17.077468715121743,
         &quot;sum&quot;: 636152.787107
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 7,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 37251,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "stats_duration": {
         "count": 37251,
         "min": 0.000003,
         "max": 36299.162081,
         "avg": 17.077468715121743,
         "sum": 636152.787107
      }
   }
}
</code></pre><h4 id="ranges-aggregation"><a name="ranges-aggregation" href="#ranges-aggregation"></a>Ranges Aggregation</h4><ul>
<li>Range를 정의하여 group by 수행</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;ranges_duration&quot;: {
      &quot;range&quot;: {
        &quot;field&quot;: &quot;duration&quot;,
        &quot;ranges&quot;: [
          {&quot;to&quot;: 600},
          {&quot;from&quot;: 600, &quot;to&quot;: 1200},
          {&quot;from&quot;: 1200, &quot;to&quot;: 1800},
          {&quot;from&quot;: 1800, &quot;to&quot;: 2400},
          {&quot;from&quot;: 3000, &quot;to&quot;: 3600},
          {&quot;from&quot;: 3600}
        ]
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "ranges_duration": {
      "range": {
        "field": "duration",
        "ranges": [
          {"to": 600},
          {"from": 600, "to": 1200},
          {"from": 1200, "to": 1800},
          {"from": 1800, "to": 2400},
          {"from": 3000, "to": 3600},
          {"from": 3600}
        ]
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 16,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 41327,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;ranges_duration&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: &quot;*-600.0&quot;,
               &quot;to&quot;: 600,
               &quot;to_as_string&quot;: &quot;600.0&quot;,
               &quot;doc_count&quot;: 41245
            },
            {
               &quot;key&quot;: &quot;600.0-1200.0&quot;,
               &quot;from&quot;: 600,
               &quot;from_as_string&quot;: &quot;600.0&quot;,
               &quot;to&quot;: 1200,
               &quot;to_as_string&quot;: &quot;1200.0&quot;,
               &quot;doc_count&quot;: 40
            },
            {
               &quot;key&quot;: &quot;1200.0-1800.0&quot;,
               &quot;from&quot;: 1200,
               &quot;from_as_string&quot;: &quot;1200.0&quot;,
               &quot;to&quot;: 1800,
               &quot;to_as_string&quot;: &quot;1800.0&quot;,
               &quot;doc_count&quot;: 11
            },
            {
               &quot;key&quot;: &quot;1800.0-2400.0&quot;,
               &quot;from&quot;: 1800,
               &quot;from_as_string&quot;: &quot;1800.0&quot;,
               &quot;to&quot;: 2400,
               &quot;to_as_string&quot;: &quot;2400.0&quot;,
               &quot;doc_count&quot;: 6
            },
            {
               &quot;key&quot;: &quot;3000.0-3600.0&quot;,
               &quot;from&quot;: 3000,
               &quot;from_as_string&quot;: &quot;3000.0&quot;,
               &quot;to&quot;: 3600,
               &quot;to_as_string&quot;: &quot;3600.0&quot;,
               &quot;doc_count&quot;: 2
            },
            {
               &quot;key&quot;: &quot;3600.0-*&quot;,
               &quot;from&quot;: 3600,
               &quot;from_as_string&quot;: &quot;3600.0&quot;,
               &quot;doc_count&quot;: 21
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 16,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 41327,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "ranges_duration": {
         "buckets": [
            {
               "key": "*-600.0",
               "to": 600,
               "to_as_string": "600.0",
               "doc_count": 41245
            },
            {
               "key": "600.0-1200.0",
               "from": 600,
               "from_as_string": "600.0",
               "to": 1200,
               "to_as_string": "1200.0",
               "doc_count": 40
            },
            {
               "key": "1200.0-1800.0",
               "from": 1200,
               "from_as_string": "1200.0",
               "to": 1800,
               "to_as_string": "1800.0",
               "doc_count": 11
            },
            {
               "key": "1800.0-2400.0",
               "from": 1800,
               "from_as_string": "1800.0",
               "to": 2400,
               "to_as_string": "2400.0",
               "doc_count": 6
            },
            {
               "key": "3000.0-3600.0",
               "from": 3000,
               "from_as_string": "3000.0",
               "to": 3600,
               "to_as_string": "3600.0",
               "doc_count": 2
            },
            {
               "key": "3600.0-*",
               "from": 3600,
               "from_as_string": "3600.0",
               "doc_count": 21
            }
         ]
      }
   }
}
</code></pre><h4 id="histogram-aggregation"><a name="histogram-aggregation" href="#histogram-aggregation"></a>Histogram Aggregation</h4><ul>
<li>Range를 Interval로 입력하여 group by 수행</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;histogram_duration&quot;: {
      &quot;histogram&quot;: {
        &quot;field&quot;: &quot;duration&quot;,
        &quot;interval&quot;: 600
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/conn/_search
{ "size": 0,
  "aggs": {
    "histogram_duration": {
      "histogram": {
        "field": "duration",
        "interval": 600
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 5,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 42679,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;histogram_duration&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: -600,
               &quot;doc_count&quot;: 4528
            },
            {
               &quot;key&quot;: 0,
               &quot;doc_count&quot;: 38061
            },
            {
               &quot;key&quot;: 600,
               &quot;doc_count&quot;: 44
            },
            {
               &quot;key&quot;: 1200,
               &quot;doc_count&quot;: 11
            },
            {
               &quot;key&quot;: 1800,
               &quot;doc_count&quot;: 7
            },
            {
               &quot;key&quot;: 2400,
               &quot;doc_count&quot;: 2
            },
            {
               &quot;key&quot;: 3000,
               &quot;doc_count&quot;: 2
            },
            {
               &quot;key&quot;: 4200,
               &quot;doc_count&quot;: 18
            },
            {
               &quot;key&quot;: 4800,
               &quot;doc_count&quot;: 1
            },
            {
               &quot;key&quot;: 8400,
               &quot;doc_count&quot;: 2
            },
            {
               &quot;key&quot;: 9600,
               &quot;doc_count&quot;: 1
            },
            {
               &quot;key&quot;: 19200,
               &quot;doc_count&quot;: 1
            },
            {
               &quot;key&quot;: 36000,
               &quot;doc_count&quot;: 1
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 5,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 42679,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "histogram_duration": {
         "buckets": [
            {
               "key": -600,
               "doc_count": 4528
            },
            {
               "key": 0,
               "doc_count": 38061
            },
            {
               "key": 600,
               "doc_count": 44
            },
            {
               "key": 1200,
               "doc_count": 11
            },
            {
               "key": 1800,
               "doc_count": 7
            },
            {
               "key": 2400,
               "doc_count": 2
            },
            {
               "key": 3000,
               "doc_count": 2
            },
            {
               "key": 4200,
               "doc_count": 18
            },
            {
               "key": 4800,
               "doc_count": 1
            },
            {
               "key": 8400,
               "doc_count": 2
            },
            {
               "key": 9600,
               "doc_count": 1
            },
            {
               "key": 19200,
               "doc_count": 1
            },
            {
               "key": 36000,
               "doc_count": 1
            }
         ]
      }
   }
}
</code></pre><ul>
<li>시간당 histogram</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141209/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;histogram_date&quot;: {
      &quot;histogram&quot;: {
        &quot;field&quot;: &quot;@timestamp&quot;,
        &quot;interval&quot;: 3600000
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141209/conn/_search
{ "size": 0,
  "aggs": {
    "histogram_date": {
      "histogram": {
        "field": "@timestamp",
        "interval": 3600000
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 25,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 108778,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;histogram_date&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T00:00:00.000Z&quot;,
               &quot;key&quot;: 1418083200000,
               &quot;doc_count&quot;: 2239
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T01:00:00.000Z&quot;,
               &quot;key&quot;: 1418086800000,
               &quot;doc_count&quot;: 2161
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T02:00:00.000Z&quot;,
               &quot;key&quot;: 1418090400000,
               &quot;doc_count&quot;: 2002
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T03:00:00.000Z&quot;,
               &quot;key&quot;: 1418094000000,
               &quot;doc_count&quot;: 2713
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T04:00:00.000Z&quot;,
               &quot;key&quot;: 1418097600000,
               &quot;doc_count&quot;: 1821
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T05:00:00.000Z&quot;,
               &quot;key&quot;: 1418101200000,
               &quot;doc_count&quot;: 1461
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T06:00:00.000Z&quot;,
               &quot;key&quot;: 1418104800000,
               &quot;doc_count&quot;: 1697
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T07:00:00.000Z&quot;,
               &quot;key&quot;: 1418108400000,
               &quot;doc_count&quot;: 2317
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T08:00:00.000Z&quot;,
               &quot;key&quot;: 1418112000000,
               &quot;doc_count&quot;: 3539
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T09:00:00.000Z&quot;,
               &quot;key&quot;: 1418115600000,
               &quot;doc_count&quot;: 12607
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T10:00:00.000Z&quot;,
               &quot;key&quot;: 1418119200000,
               &quot;doc_count&quot;: 8612
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T11:00:00.000Z&quot;,
               &quot;key&quot;: 1418122800000,
               &quot;doc_count&quot;: 13738
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T12:00:00.000Z&quot;,
               &quot;key&quot;: 1418126400000,
               &quot;doc_count&quot;: 17208
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T13:00:00.000Z&quot;,
               &quot;key&quot;: 1418130000000,
               &quot;doc_count&quot;: 6518
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T14:00:00.000Z&quot;,
               &quot;key&quot;: 1418133600000,
               &quot;doc_count&quot;: 14880
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T15:00:00.000Z&quot;,
               &quot;key&quot;: 1418137200000,
               &quot;doc_count&quot;: 12090
            },
            {
               &quot;key_as_string&quot;: &quot;2014-12-09T16:00:00.000Z&quot;,
               &quot;key&quot;: 1418140800000,
               &quot;doc_count&quot;: 3175
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 25,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 108778,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "histogram_date": {
         "buckets": [
            {
               "key_as_string": "2014-12-09T00:00:00.000Z",
               "key": 1418083200000,
               "doc_count": 2239
            },
            {
               "key_as_string": "2014-12-09T01:00:00.000Z",
               "key": 1418086800000,
               "doc_count": 2161
            },
            {
               "key_as_string": "2014-12-09T02:00:00.000Z",
               "key": 1418090400000,
               "doc_count": 2002
            },
            {
               "key_as_string": "2014-12-09T03:00:00.000Z",
               "key": 1418094000000,
               "doc_count": 2713
            },
            {
               "key_as_string": "2014-12-09T04:00:00.000Z",
               "key": 1418097600000,
               "doc_count": 1821
            },
            {
               "key_as_string": "2014-12-09T05:00:00.000Z",
               "key": 1418101200000,
               "doc_count": 1461
            },
            {
               "key_as_string": "2014-12-09T06:00:00.000Z",
               "key": 1418104800000,
               "doc_count": 1697
            },
            {
               "key_as_string": "2014-12-09T07:00:00.000Z",
               "key": 1418108400000,
               "doc_count": 2317
            },
            {
               "key_as_string": "2014-12-09T08:00:00.000Z",
               "key": 1418112000000,
               "doc_count": 3539
            },
            {
               "key_as_string": "2014-12-09T09:00:00.000Z",
               "key": 1418115600000,
               "doc_count": 12607
            },
            {
               "key_as_string": "2014-12-09T10:00:00.000Z",
               "key": 1418119200000,
               "doc_count": 8612
            },
            {
               "key_as_string": "2014-12-09T11:00:00.000Z",
               "key": 1418122800000,
               "doc_count": 13738
            },
            {
               "key_as_string": "2014-12-09T12:00:00.000Z",
               "key": 1418126400000,
               "doc_count": 17208
            },
            {
               "key_as_string": "2014-12-09T13:00:00.000Z",
               "key": 1418130000000,
               "doc_count": 6518
            },
            {
               "key_as_string": "2014-12-09T14:00:00.000Z",
               "key": 1418133600000,
               "doc_count": 14880
            },
            {
               "key_as_string": "2014-12-09T15:00:00.000Z",
               "key": 1418137200000,
               "doc_count": 12090
            },
            {
               "key_as_string": "2014-12-09T16:00:00.000Z",
               "key": 1418140800000,
               "doc_count": 3175
            }
         ]
      }
   }
}
</code></pre><ul>
<li>현재 시간 기준으로 일별 histogram</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /_all/conn/_search
{ &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;histogram_date&quot;: {
      &quot;histogram&quot;: {
        &quot;field&quot;: &quot;@timestamp&quot;,
        &quot;interval&quot;: 144000000
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /_all/conn/_search
{ "size": 0,
  "aggs": {
    "histogram_date": {
      "histogram": {
        "field": "@timestamp",
        "interval": 144000000
      }
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 24,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 69,
      &quot;successful&quot;: 63,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 759372,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;histogram_date&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: 1417392000000,
               &quot;doc_count&quot;: 5
            },
            {
               &quot;key&quot;: 1417536000000,
               &quot;doc_count&quot;: 127711
            },
            {
               &quot;key&quot;: 1417680000000,
               &quot;doc_count&quot;: 184003
            },
            {
               &quot;key&quot;: 1417824000000,
               &quot;doc_count&quot;: 100107
            },
            {
               &quot;key&quot;: 1417968000000,
               &quot;doc_count&quot;: 254950
            },
            {
               &quot;key&quot;: 1418112000000,
               &quot;doc_count&quot;: 92596
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 24,
   "timed_out": false,
   "_shards": {
      "total": 69,
      "successful": 63,
      "failed": 0
   },
   "hits": {
      "total": 759372,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "histogram_date": {
         "buckets": [
            {
               "key": 1417392000000,
               "doc_count": 5
            },
            {
               "key": 1417536000000,
               "doc_count": 127711
            },
            {
               "key": 1417680000000,
               "doc_count": 184003
            },
            {
               "key": 1417824000000,
               "doc_count": 100107
            },
            {
               "key": 1417968000000,
               "doc_count": 254950
            },
            {
               "key": 1418112000000,
               "doc_count": 92596
            }
         ]
      }
   }
}
</code></pre><h4 id="date-range-aggregation"><a name="date-range-aggregation" href="#date-range-aggregation"></a>Date Range Aggregation</h4><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /_all/conn/_search
{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
      &quot;range&quot;: {
          &quot;date_range&quot;: {
              &quot;field&quot;: &quot;@timestamp&quot;,
              &quot;format&quot;: &quot;YYYY-MM-dd&quot;,
              &quot;ranges&quot;: [
                  { &quot;from&quot; : &quot;now-2d&quot;, &quot;to&quot;: &quot;now-1d&quot; },
                  { &quot;from&quot;: &quot;now-1d&quot; }
              ]
          }
      }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /_all/conn/_search
{
  "size": 0,
  "aggs": {
      "range": {
          "date_range": {
              "field": "@timestamp",
              "format": "YYYY-MM-dd",
              "ranges": [
                  { "from" : "now-2d", "to": "now-1d" },
                  { "from": "now-1d" }
              ]
          }
      }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 16,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 69,
      &quot;successful&quot;: 69,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 758434,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;range&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: &quot;2014-12-07-2014-12-08&quot;,
               &quot;from&quot;: 1417936217609,
               &quot;from_as_string&quot;: &quot;2014-12-07&quot;,
               &quot;to&quot;: 1418022617609,
               &quot;to_as_string&quot;: &quot;2014-12-08&quot;,
               &quot;doc_count&quot;: 61202
            },
            {
               &quot;key&quot;: &quot;2014-12-08-*&quot;,
               &quot;from&quot;: 1418022617609,
               &quot;from_as_string&quot;: &quot;2014-12-08&quot;,
               &quot;doc_count&quot;: 307813
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 16,
   "timed_out": false,
   "_shards": {
      "total": 69,
      "successful": 69,
      "failed": 0
   },
   "hits": {
      "total": 758434,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "range": {
         "buckets": [
            {
               "key": "2014-12-07-2014-12-08",
               "from": 1417936217609,
               "from_as_string": "2014-12-07",
               "to": 1418022617609,
               "to_as_string": "2014-12-08",
               "doc_count": 61202
            },
            {
               "key": "2014-12-08-*",
               "from": 1418022617609,
               "from_as_string": "2014-12-08",
               "doc_count": 307813
            }
         ]
      }
   }
}
</code></pre><h4 id="ip-range-aggregation"><a name="ip-range-aggregation" href="#ip-range-aggregation"></a>Ip Range Aggregation</h4><ul>
<li>데이터를 ip type으로 지정하면 ipv6에 대해서는 수용하지 못하고 drop됨</li>
<li>string검색은 불가능함</li>
<li>(from ~ to) 방식</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /test1/type1/_search
{
  &quot;size&quot;: 0,
  &quot;aggs&quot; : {
        &quot;ip_ranges&quot; : {
            &quot;ip_range&quot; : {
                &quot;field&quot; : &quot;src_ip&quot;,
                &quot;ranges&quot; : [
                    { &quot;to&quot; : &quot;192.168.1.55&quot; },
                    { &quot;from&quot; : &quot;192.168.1.55&quot; }
                ]
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;">GET /test1/type1/_search
{
  "size": 0,
  "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "src_ip",
                "ranges" : [
                    { "to" : "192.168.1.55" },
                    { "from" : "192.168.1.55" }
                ]
            }
        }
    }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 16,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 75125,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;ip_ranges&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: &quot;*-192.168.1.55&quot;,
               &quot;to&quot;: 3232235831,
               &quot;to_as_string&quot;: &quot;192.168.1.55&quot;,
               &quot;doc_count&quot;: 11899
            },
            {
               &quot;key&quot;: &quot;192.168.1.55-*&quot;,
               &quot;from&quot;: 3232235831,
               &quot;from_as_string&quot;: &quot;192.168.1.55&quot;,
               &quot;doc_count&quot;: 63226
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 16,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 75125,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "ip_ranges": {
         "buckets": [
            {
               "key": "*-192.168.1.55",
               "to": 3232235831,
               "to_as_string": "192.168.1.55",
               "doc_count": 11899
            },
            {
               "key": "192.168.1.55-*",
               "from": 3232235831,
               "from_as_string": "192.168.1.55",
               "doc_count": 63226
            }
         ]
      }
   }
}
</code></pre><ul>
<li>mask방식</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /test1/type1/_search
{
  &quot;size&quot;: 0,
  &quot;aggs&quot; : {
        &quot;ip_ranges&quot; : {
            &quot;ip_range&quot; : {
                &quot;field&quot; : &quot;src_ip&quot;,
                &quot;ranges&quot; : [
                    { &quot;mask&quot; : &quot;192.168.1.0/24&quot; },
                    { &quot;mask&quot; : &quot;172.16.2.0/24&quot; }
                ]
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;">GET /test1/type1/_search
{
  "size": 0,
  "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "src_ip",
                "ranges" : [
                    { "mask" : "192.168.1.0/24" },
                    { "mask" : "172.16.2.0/24" }
                ]
            }
        }
    }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 8,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 75125,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;ip_ranges&quot;: {
         &quot;buckets&quot;: [
            {
               &quot;key&quot;: &quot;172.16.2.0/24&quot;,
               &quot;from&quot;: 2886730240,
               &quot;from_as_string&quot;: &quot;172.16.2.0&quot;,
               &quot;to&quot;: 2886730496,
               &quot;to_as_string&quot;: &quot;172.16.3.0&quot;,
               &quot;doc_count&quot;: 61
            },
            {
               &quot;key&quot;: &quot;192.168.1.0/24&quot;,
               &quot;from&quot;: 3232235776,
               &quot;from_as_string&quot;: &quot;192.168.1.0&quot;,
               &quot;to&quot;: 3232236032,
               &quot;to_as_string&quot;: &quot;192.168.2.0&quot;,
               &quot;doc_count&quot;: 73773
            }
         ]
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 8,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 75125,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "ip_ranges": {
         "buckets": [
            {
               "key": "172.16.2.0/24",
               "from": 2886730240,
               "from_as_string": "172.16.2.0",
               "to": 2886730496,
               "to_as_string": "172.16.3.0",
               "doc_count": 61
            },
            {
               "key": "192.168.1.0/24",
               "from": 3232235776,
               "from_as_string": "192.168.1.0",
               "to": 3232236032,
               "to_as_string": "192.168.2.0",
               "doc_count": 73773
            }
         ]
      }
   }
}
</code></pre><h4 id="cardinality-aggregation"><a name="cardinality-aggregation" href="#cardinality-aggregation"></a>Cardinality Aggregation</h4><ul>
<li>unique count 를 계산하기 위해서 사용됨</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141207/_search
{ &quot;size&quot;: 0,
  &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;query&quot;: &quot;*:*&quot;
    }
  },
  &quot;aggs&quot;: {
    &quot;src_ip_count&quot;: {
      &quot;cardinality&quot;: {
        &quot;field&quot;: &quot;src_ip&quot;
      }
    },
    &quot;dst_ip_count&quot;: {
      &quot;cardinality&quot;: {
        &quot;field&quot;: &quot;dst_ip&quot;
      }
    },
    &quot;dst_cc_count&quot;: {
      &quot;cardinality&quot;: {
        &quot;field&quot;: &quot;dst_cc&quot;
      }
    },
    &quot;dst_port_count&quot;: {
      &quot;cardinality&quot;: {
        &quot;field&quot;: &quot;dst_port&quot;
      }
    }
  }
}}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141207/_search
{ "size": 0,
  "query": {
      "query_string": {
        "query": "*:*"
    }
  },
  "aggs": {
    "src_ip_count": {
      "cardinality": {
        "field": "src_ip"
      }
    },
    "dst_ip_count": {
      "cardinality": {
        "field": "dst_ip"
      }
    },
    "dst_cc_count": {
      "cardinality": {
        "field": "dst_cc"
      }
    },
    "dst_port_count": {
      "cardinality": {
        "field": "dst_port"
      }
    }
  }
}}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 9,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 70551,
      &quot;max_score&quot;: 0,
      &quot;hits&quot;: []
   },
   &quot;aggregations&quot;: {
      &quot;dst_cc_count&quot;: {
         &quot;value&quot;: 63
      },
      &quot;dst_ip_count&quot;: {
         &quot;value&quot;: 5092
      },
      &quot;dst_port_count&quot;: {
         &quot;value&quot;: 81
      },
      &quot;src_ip_count&quot;: {
         &quot;value&quot;: 973
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 9,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 70551,
      "max_score": 0,
      "hits": []
   },
   "aggregations": {
      "dst_cc_count": {
         "value": 63
      },
      "dst_ip_count": {
         "value": 5092
      },
      "dst_port_count": {
         "value": 81
      },
      "src_ip_count": {
         "value": 973
      }
   }
}
</code></pre><h4 id="-"><a name="-" href="#-"></a>기타</h4><ul>
<li>음수(negative value)검색</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/_search?q=duration:(\-1)&amp;amp;size=100
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/_search?q=duration:(\-1)&amp;size=100
</code></pre><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/_search
{ &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;query&quot;: &quot;duration:(\\-1)&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/_search
{ "query": {
      "query_string": {
        "query": "duration:(\\-1)"
    }
  }
}
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
   &quot;took&quot;: 1,
   &quot;timed_out&quot;: false,
   &quot;_shards&quot;: {
      &quot;total&quot;: 5,
      &quot;successful&quot;: 5,
      &quot;failed&quot;: 0
   },
   &quot;hits&quot;: {
      &quot;total&quot;: 13638,
      &quot;max_score&quot;: 1,
      &quot;hits&quot;: [
         {
            &quot;_index&quot;: &quot;connectome-20141205&quot;,
            &quot;_type&quot;: &quot;conn&quot;,
            &quot;_id&quot;: &quot;CW7uUz1MefhtkT5q7&quot;,
            &quot;_score&quot;: 1,
            &quot;_source&quot;: {
               &quot;report_time&quot;: &quot;20141205000036&quot;,
               &quot;src_bytes&quot;: -1,
               &quot;uid&quot;: &quot;CW7uUz1MefhtkT5q7&quot;,
               &quot;src_asname&quot;: &quot;unknown-0&quot;,
               &quot;@timestamp&quot;: &quot;2014-12-05T00:00:36+00:00&quot;,
               &quot;resp_cname&quot;: &quot;Korea Republic of&quot;,
               &quot;tunnel_parents&quot;: &quot;(empty)&quot;,
               &quot;dst_ip_bytes&quot;: 0,
               &quot;dst_asn&quot;: 4766,
               &quot;dst_asname&quot;: &quot;Korea Telecom&quot;,
               &quot;duration&quot;: -1,
               &quot;src_lati&quot;: 0,
               &quot;src_port&quot;: &quot;59481&quot;,
               &quot;src_country_name&quot;: &quot;unknown-&quot;,
               &quot;conn_state&quot;: &quot;S0&quot;,
               &quot;pcr&quot;: -1,
               &quot;elastic_time&quot;: &quot;20141205000048&quot;,
               &quot;src_asn&quot;: 0,
               &quot;src_ip&quot;: &quot;192.168.1.29&quot;,
               &quot;src_cc&quot;: &quot;(empty)&quot;,
               &quot;src_pkts&quot;: 1,
               &quot;dst_long&quot;: 126.980003,
               &quot;dst_cc&quot;: &quot;KR&quot;,
               &quot;device_ip&quot;: &quot;172.16.2.3&quot;,
               &quot;prtc&quot;: &quot;tcp&quot;,
               &quot;dst_lati&quot;: 37.57,
               &quot;missed_bytes&quot;: 0,
               &quot;app_prtc&quot;: &quot;-&quot;,
               &quot;conn_local&quot;: &quot;T&quot;,
               &quot;dst_pkts&quot;: 0,
               &quot;log_type_Name&quot;: &quot;conn.log&quot;,
               &quot;src_long&quot;: 0,
               &quot;eps_time&quot;: &quot;1417705236.438597&quot;,
               &quot;dst_port&quot;: &quot;6881&quot;,
               &quot;dst_ip&quot;: &quot;222.98.132.4&quot;,
               &quot;src_ip_bytes&quot;: 48,
               &quot;dst_bytes&quot;: -1,
               &quot;history&quot;: &quot;S&quot;
            }
         },
&lt;/code&gt;&lt;/pre&gt;">{
   "took": 1,
   "timed_out": false,
   "_shards": {
      "total": 5,
      "successful": 5,
      "failed": 0
   },
   "hits": {
      "total": 13638,
      "max_score": 1,
      "hits": [
         {
            "_index": "connectome-20141205",
            "_type": "conn",
            "_id": "CW7uUz1MefhtkT5q7",
            "_score": 1,
            "_source": {
               "report_time": "20141205000036",
               "src_bytes": -1,
               "uid": "CW7uUz1MefhtkT5q7",
               "src_asname": "unknown-0",
               "@timestamp": "2014-12-05T00:00:36+00:00",
               "resp_cname": "Korea Republic of",
               "tunnel_parents": "(empty)",
               "dst_ip_bytes": 0,
               "dst_asn": 4766,
               "dst_asname": "Korea Telecom",
               "duration": -1,
               "src_lati": 0,
               "src_port": "59481",
               "src_country_name": "unknown-",
               "conn_state": "S0",
               "pcr": -1,
               "elastic_time": "20141205000048",
               "src_asn": 0,
               "src_ip": "192.168.1.29",
               "src_cc": "(empty)",
               "src_pkts": 1,
               "dst_long": 126.980003,
               "dst_cc": "KR",
               "device_ip": "172.16.2.3",
               "prtc": "tcp",
               "dst_lati": 37.57,
               "missed_bytes": 0,
               "app_prtc": "-",
               "conn_local": "T",
               "dst_pkts": 0,
               "log_type_Name": "conn.log",
               "src_long": 0,
               "eps_time": "1417705236.438597",
               "dst_port": "6881",
               "dst_ip": "222.98.132.4",
               "src_ip_bytes": 48,
               "dst_bytes": -1,
               "history": "S"
            }
         },
</code></pre><ul>
<li>특수문자로 dash(-)는 같은 방법을 검색 불가능</li>
</ul><pre><code data-origin="&lt;pre&gt;&lt;code&gt;GET /connectome-20141205/_search?q=app_prtc:(\-)

GET /connectome-20141205/_search
{ &quot;query&quot;: {
      &quot;query_string&quot;: {
        &quot;query&quot;: &quot;app_prtc:(\\-)&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;">GET /connectome-20141205/_search?q=app_prtc:(\-)

GET /connectome-20141205/_search
{ "query": {
      "query_string": {
        "query": "app_prtc:(\\-)"
    }
  }
}
</code></pre><h3 id="search-template"><a name="search-template" href="#search-template"></a>search template</h3><h3 id="search-shards-api"><a name="search-shards-api" href="#search-shards-api"></a>search shards api</h3><ul>
<li>검색을 수행하는 인덱스와 샤드의 정보를 검색하는 명령어</li>
</ul><h3 id="facets"><a name="facets" href="#facets"></a>facets</h3><p><em class="underline">Facets are deprecated and will be removed in a future release. You are encouraged to migrate to aggregations instead.</em></p><h3 id="suggesters"><a name="suggesters" href="#suggesters"></a>suggesters</h3><h3 id="multi-search-api"><a name="multi-search-api" href="#multi-search-api"></a>multi search api</h3><h3 id="count-api"><a name="count-api" href="#count-api"></a>count api</h3><h3 id="search-exists-api"><a name="search-exists-api" href="#search-exists-api"></a>search exists api</h3><h3 id="validate-api"><a name="validate-api" href="#validate-api"></a>validate api</h3><h3 id="explain-api"><a name="explain-api" href="#explain-api"></a>explain api</h3><ul>
<li>like expalin SQL</li>
</ul><h3 id="percolator"><a name="percolator" href="#percolator"></a>percolator</h3><ul>
<li>Traditionally you design documents based on your data and store them into an index and then define queries via the search api in order to retrieve these documents. The percolator works in the opposite direction, first you store queries into an index and then via the percolate api you define documents in order to retrieve these queries.</li>
</ul><h3 id="more-like-this-api"><a name="more-like-this-api" href="#more-like-this-api"></a>more like this api</h3><h2 id="analysis"><a name="analysis" href="#analysis"></a>Analysis</h2><pre><code data-origin="&lt;pre&gt;&lt;code&gt;curl -XGET 'localhost:9200/_analyze?analyzer=standard&amp;amp;pretty' -d 'this is a test'
&lt;/code&gt;&lt;/pre&gt;">curl -XGET 'localhost:9200/_analyze?analyzer=standard&amp;pretty' -d 'this is a test'
</code></pre><p><code>Result</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;{
  &quot;tokens&quot; : [ {
    &quot;token&quot; : &quot;this&quot;,
    &quot;start_offset&quot; : 0,
    &quot;end_offset&quot; : 4,
    &quot;type&quot; : &quot;&amp;lt;ALPHANUM&amp;gt;&quot;,
    &quot;position&quot; : 1
  }, {
    &quot;token&quot; : &quot;is&quot;,
    &quot;start_offset&quot; : 5,
    &quot;end_offset&quot; : 7,
    &quot;type&quot; : &quot;&amp;lt;ALPHANUM&amp;gt;&quot;,
    &quot;position&quot; : 2
  }, {
    &quot;token&quot; : &quot;a&quot;,
    &quot;start_offset&quot; : 8,
    &quot;end_offset&quot; : 9,
    &quot;type&quot; : &quot;&amp;lt;ALPHANUM&amp;gt;&quot;,
    &quot;position&quot; : 3
  }, {
    &quot;token&quot; : &quot;test&quot;,
    &quot;start_offset&quot; : 10,
    &quot;end_offset&quot; : 14,
    &quot;type&quot; : &quot;&amp;lt;ALPHANUM&amp;gt;&quot;,
    &quot;position&quot; : 4
  } ]
}
&lt;/code&gt;&lt;/pre&gt;">{
  "tokens" : [ {
    "token" : "this",
    "start_offset" : 0,
    "end_offset" : 4,
    "type" : "&lt;ALPHANUM&gt;",
    "position" : 1
  }, {
    "token" : "is",
    "start_offset" : 5,
    "end_offset" : 7,
    "type" : "&lt;ALPHANUM&gt;",
    "position" : 2
  }, {
    "token" : "a",
    "start_offset" : 8,
    "end_offset" : 9,
    "type" : "&lt;ALPHANUM&gt;",
    "position" : 3
  }, {
    "token" : "test",
    "start_offset" : 10,
    "end_offset" : 14,
    "type" : "&lt;ALPHANUM&gt;",
    "position" : 4
  } ]
}
</code></pre><p><code>example</code></p><pre><code data-origin="&lt;pre&gt;&lt;code&gt;csv_fd = open(&quot;search_result.csv&quot;, 'w')
res = es.search(index=&quot;connectome-20141209&quot;, doc_type=&quot;conn&quot;, body={&quot;size&quot;: 80000, &quot;query&quot;: {&quot;query_string&quot;: {&quot;query&quot; : &quot;*:*&quot;}}})
        # index부분을 명시하지 않으면 모든 index에서 검색한다. size를 명시하지 않으면 기본적으로 10개만 가져 온다.
        # res = es.search(doc_type=&quot;tagconn&quot;, body={&quot;query&quot;: {&quot;range&quot;: {&quot;duration&quot; : { &quot;gte&quot; : 3000 }}}})
        print(&quot;Got %d Hits:&quot; % res['hits']['total'])
        csv_fd.write(&quot;Got %d Hits:&quot; % res['hits']['total'])
        csv_fd.write(&quot;\n&quot;)

        for hit in res['hits']['hits']:
                a = hit[&quot;_source&quot;]
                line = &quot;&quot;
                for field in tagconn_fields :
                        if (type(a[field])  float) :
                                line += &quot;%0.1f&quot; % a[field]
                        else :
                                line += &quot;\&quot;%s\&quot;&quot; % a[field]
                        line += delimiter
                line = line[0:-1]
                csv_fd.write(line)
                csv_fd.write(&quot;\n&quot;)

        csv_fd.close()
&lt;/code&gt;&lt;/pre&gt;">csv_fd = open("search_result.csv", 'w')
res = es.search(index="connectome-20141209", doc_type="conn", body={"size": 80000, "query": {"query_string": {"query" : "*:*"}}})
        # index부분을 명시하지 않으면 모든 index에서 검색한다. size를 명시하지 않으면 기본적으로 10개만 가져 온다.
        # res = es.search(doc_type="tagconn", body={"query": {"range": {"duration" : { "gte" : 3000 }}}})
        print("Got %d Hits:" % res['hits']['total'])
        csv_fd.write("Got %d Hits:" % res['hits']['total'])
        csv_fd.write("\n")

        for hit in res['hits']['hits']:
                a = hit["_source"]
                line = ""
                for field in tagconn_fields :
                        if (type(a[field])  float) :
                                line += "%0.1f" % a[field]
                        else :
                                line += "\"%s\"" % a[field]
                        line += delimiter
                line = line[0:-1]
                csv_fd.write(line)
                csv_fd.write("\n")

        csv_fd.close()
</code></pre>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
